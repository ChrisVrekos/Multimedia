= Documentation Template for Streaming Video System
:author: ChrisVrekos
:date: 2025-05-28

== Πολυμέσα και Πολυμεσικές Επικοινωνίες 2024-25
8ο εξάμηνο  
Ατομική Απαλλακτική Εργασία (Semester Project)  
*Προχωρημένη Υλοποίηση Συστήματος Streaming Video με Μοντέλο Client-Server*

== 1. Περιγραφή του Συστήματος και των Λειτουργιών του

=== 1.1 Περιγραφή του Συστήματος
Το σύστημα αποτελείται από δύο κύριες εφαρμογές:

* Streaming Server:
  - Διαχειρίζεται μια λίστα των διαθέσιμων αρχείων βίντεο.
  - Ελέγχει αν υπάρχουν όλες οι απαιτούμενες μετατροπές (σε διαφορετικές αναλύσεις και μορφές) για κάθε βίντεο και, εάν υπάρχουν κενά, ενεργοποιεί τη μετατροπή τους μέσω του FFmpeg.
  - Επικοινωνεί με τον πελάτη (Client) μέσω Java Sockets, αποστέλλοντας τις πληροφορίες των αρχείων και ξεκινώντας τη ροή του βίντεο.

* Streaming Client:
  - Συνδέεται με τον Streaming Server για να λαμβάνει τη λίστα των διαθέσιμων βίντεο.
  - Επιτρέπει στον χρήστη να επιλέξει το επιθυμητό βίντεο και το πρωτόκολλο μετάδοσης.
  - Με βάση τη σύνδεση (και ενδεχομένως με χρήση βιβλιοθήκης για ταχύτητα σύνδεσης) προσαρμόζει την ποιότητα του βίντεο που θα παραληφθεί.
  - Στην τρέχουσα έκδοση, η διεπαφή είναι γραμμής εντολών. Μελλοντικές επεκτάσεις μπορούν να υποστηρίξουν γραφικό περιβάλλον (GUI).

=== 1.2 Παρουσίαση του Τελικού Υλοποιημένου Συστήματος
Το ολοκληρωμένο σύστημα περιλαμβάνει:

- Επικοινωνία Client-Server μέσω Java Sockets, με δυνατότητα εξυπηρέτησης πολλαπλών πελατών ταυτόχρονα (multi-threading).
- Αυτόματη αναγνώριση των αρχείων βίντεο στον κατάλογο και ανάλυση/μετατροπή τους σε διαφορετικές αναλύσεις και μορφές με χρήση FFmpeg (μέσω του Jaffree).
- Καταγραφή σημαντικών γεγονότων και λαθών κατά τη διαδικασία μετατροπής (μέσω καταγραφής στο console, με προτάσεις για μελλοντική ενσωμάτωση Logger).
- Σενάρια εκτέλεσης που περιλαμβάνουν:
  - Εκκίνηση του Server και λήψη του αρχικού μηνύματος συστήματος.
  - Επικοινωνία του Client για αίτηση λίστας βίντεο και λήψη των σχετικών πληροφοριών.
  - Εντολές όπως "LIST" και "GET <video>" από τον client.

(Παρέχονται screenshots και περαιτέρω περιγραφές κατά την τελική παρουσίαση.)

=== 1.3 Παρουσίαση Προβλημάτων και Τρόπων Επίλυσης
Κατά την υλοποίηση του συστήματος προέκυψαν τα εξής ζητήματα:

- Διαχείριση ταυτόχρονων μετατροπών βίντεο:
  - Εφαρμογή κλειδώματος αρχείων (File Lock) για αποφυγή διπλών μετατροπών.
- Επικοινωνία Client-Server:
  - Αρχικά προβλήματα σύνδεσης και διαχείρισης πολλαπλών συνδέσεων, επιλύθηκαν με multi-threading και χρήση shutdown hook για ομαλή διακοπή.
- Ενσωμάτωση του FFmpeg μέσω του Jaffree:
  - Προβλήματα ρυθμίσεων παραμέτρων μετατροπής (bitrate, resolution) που απαιτούσαν προσαρμογές.
- Λειτουργίες σε φάση μελλοντικής ανάπτυξης:
  - Δυναμική αλλαγή ποιότητας βάσει bandwidth.
  - Ενσωμάτωση GUI.
  - Υποστήριξη επιπλέον πρωτοκόλλων μετάδοσης (UDP, TCP, RTP/UDP).

=== 1.4 Βελτίωση της Λειτουργίας Απελευθέρωσης Κλειδώματος
Πριν την υλοποίηση της βοηθητικής κλάσης LockWithChannel, παρατηρήθηκε πως κάποια αρχεία κλειδώματος δεν διαγράφονταν μετά την επιτυχή μετατροπή. Με τη δημιουργία της κλάσης LockWithChannel, όπου αποθηκεύονται το FileLock, FileChannel και RandomAccessFile, και με τη χρήση try-catch block για σωστό τερματισμό και απελευθέρωση πόρων, διορθώθηκε το πρόβλημα και διασφαλίστηκε η ομαλή λειτουργία των μετατροπών.

=== 1.5 Πρόσθετα Στοιχεία / Προδιαγραφές (Specs)
Συμπληρώστε επιπλέον περιγραφές και προδιαγραφές για χαρακτηριστικά που απαιτούνται ή θα υλοποιηθούν στο μέλλον:

- Υποστήριξη προσαρμοστικής ροής (adaptive streaming)
- Ενσωμάτωση γραφικού περιβάλλοντος (GUI)
- Ασφάλεια επικοινωνίας μέσω SSL/TLS 
- Επιπλέον πρωτόκολλα μετάδοσης (UDP, TCP, RTP/UDP)
- Άλλες λειτουργίες: [Συμπληρώστε ...]

== 2. Τεκμηρίωση Κλάσεων

=== 2.1 StreamingServer.java
*Σκοπός:*  
Υλοποίηση του Server που:
- Διαχειρίζεται τα βίντεο και ελέγχει τη διαθεσιμότητα των απαιτούμενων μετατροπών.
- Ενεργοποιεί το FFmpeg για την παραγωγή των ελλειπόντων αρχείων.
- Επικοινωνεί με τους πελάτες μέσω Java Sockets.

*Λειτουργίες και Παραδείγματα:*

[source,java]
----
/* Παράδειγμα εκκίνησης του Server */
System.out.println("Server running on port " + port);
----

[source,java]
----
/* Παράδειγμα διαχείρισης πολλαπλών συνδέσεων */
if (activeConnections.get() >= MAX_CONNECTIONS) {
    Thread.sleep(100);
    continue;
}
----

=== 2.2 StreamingClient.java
*Σκοπός:*  
Διαχείριση της επικοινωνίας με τον Server, λήψη λίστας βίντεο, επιλογή αρχείου και πρωτοκόλλου μετάδοσης, καθώς και αναπαραγωγή του video.

*Λειτουργίες και Παραδείγματα:*

[source,java]
----
/* Παράδειγμα επεξεργασίας εντολών από τον Client */
if (command.startsWith("LIST")) {
    return videoManager.getVideoList();
} else if (command.startsWith("GET ")) {
    String videoName = command.substring(4);
    return videoManager.getVideoInfo(videoName);
}
----

=== 2.3 Βοηθητικές Κλάσεις (π.χ., LockWithChannel, VideoManager)
*Σκοπός:*  
Παροχή βοηθητικών λειτουργιών, όπως ο έλεγχος κλειδώματος αρχείων κατά τη μετατροπή βίντεο.

*Λειτουργίες και Παραδείγματα:*

[source,java]
----
/* Παράδειγμα χρήσης του File Lock */
if (!acquireLock(videoName, targetQuality, targetFormat)) {
    System.out.println("Conversion already in progress by another instance: " + videoName + "-" + targetQuality + "." + targetFormat);
    return;
}
----

== 3. Αναφορά Προβλημάτων & Troubleshooting

*Τεχνικά Ζητήματα:*

- Διαχείριση ταυτόχρονων μετατροπών βίντεο με File Lock.
- Προβλήματα επικοινωνίας Client-Server, επιλύθηκαν με multi-threading και ομαλή διακοπή.
- Προβλήματα παραμέτρων μετατροπής στο FFmpeg, επιλύθηκαν με προσαρμογή ρυθμίσεων.

*Λύσεις:*

- Εφαρμογή της κλάσης LockWithChannel.
- Βελτιστοποίηση της διαχείρισης συνδέσεων.
- Ενημέρωση παραμέτρων FFmpeg.

== 4. Checklists Λειτουργιών και Αιτίες Μη Υλοποίησης

=== 4.1 Checklists Λειτουργιών ανά Επίπεδο

*Βασικό Επίπεδο:*

- [ ] Επικοινωνία μέσω Java Sockets
- [ ] Μετατροπή βίντεο με FFmpeg (μέσω Jaffree)
- [ ] Διαχείριση λίστας αρχείων
- [ ] CLI διεπαφή

*Μέτριο Επίπεδο:*

- [ ] Υποστήριξη multi-threading
- [ ] Εφαρμογή caching/buffering για ομαλή αναπαραγωγή
- [ ] Καταγραφή στατιστικών (χρόνος, bitrate)
- [ ] Δυναμική επιλογή πρωτοκόλλου μετάδοσης

*Προχωρημένο Επίπεδο:*

- [ ] Adaptive streaming βάσει αποτελεσμάτων speed test
- [ ] Load Balancer για κατανομή αιτήσεων
- [ ] Αποθήκευση streamed video στον client
- [ ] Ενσωμάτωση ασφάλειας επικοινωνίας (SSL/TLS)

=== 4.2 Αιτίες Μερικής ή Μη Υλοποίησης

Για χαρακτηριστικά που δεν υλοποιήθηκαν πλήρως:

- Δυναμική αλλαγή ποιότητας βάσει bandwidth: Ακόμη υπό εξέλιξη.
- Ενσωμάτωση GUI: Προγραμματίζεται για μελλοντική έκδοση.
- Υποστήριξη επιπλέον πρωτοκόλλων μετάδοσης: Σε φάση σχεδιασμού.
- [Προσθέστε επιπλέον αιτίες και σχόλια όπως απαιτείται.]

== 5. Συμπεράσματα και Προτάσεις

Συνοψίζοντας:

- Το σύστημα υλοποιεί τις βασικές απαιτήσεις του έργου.
- Παρέχει υποδομές για μελλοντικές επεκτάσεις (GUI, επιπλέον πρωτόκολλα, adaptive streaming).
- Ορισμένα ζητήματα παραμένουν ανοικτά και αποτελούν ευκαιρία για περαιτέρω βελτιστοποίηση και ανάπτυξη.

== 6. Παραρτήματα και Πρόσθετα Έγγραφα

*Παραρτήματα:*

- Code snippets
- Screenshots και περιγραφές εκτέλεσης
- Πρόσθετα τεχνικά έγγραφα / specifications

[Εισάγετε επιπλέον προδιαγραφές, σχολιασμούς και άλλα σχετικά έγγραφα εδώ]