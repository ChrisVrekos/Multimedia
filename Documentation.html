<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="Χρήστος Βρέκος (Α.Μ. 21390027)">
<title>Εργασια Multimedia Streaming</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.pygments .hll { background-color: #ffffcc }
pre.pygments { background: #f0f3f3; }
pre.pygments .tok-c { color: #0099FF; font-style: italic } /* Comment */
pre.pygments .tok-err { color: #AA0000; background-color: #FFAAAA } /* Error */
pre.pygments .tok-k { color: #006699; font-weight: bold } /* Keyword */
pre.pygments .tok-o { color: #555555 } /* Operator */
pre.pygments .tok-ch { color: #0099FF; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #0099FF; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #009999 } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #0099FF; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #0099FF; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #0099FF; font-weight: bold; font-style: italic } /* Comment.Special */
pre.pygments .tok-gd { background-color: #FFCCCC; border: 1px solid #CC0000 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
pre.pygments .tok-gr { color: #FF0000 } /* Generic.Error */
pre.pygments .tok-gh { color: #003300; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { background-color: #CCFFCC; border: 1px solid #00CC00 } /* Generic.Inserted */
pre.pygments .tok-go { color: #AAAAAA } /* Generic.Output */
pre.pygments .tok-gp { color: #000099; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #003300; font-weight: bold } /* Generic.Subheading */
pre.pygments .tok-gt { color: #99CC66 } /* Generic.Traceback */
pre.pygments .tok-kc { color: #006699; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #006699; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #006699; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #006699 } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #006699; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #007788; font-weight: bold } /* Keyword.Type */
pre.pygments .tok-m { color: #FF6600 } /* Literal.Number */
pre.pygments .tok-s { color: #CC3300 } /* Literal.String */
pre.pygments .tok-na { color: #330099 } /* Name.Attribute */
pre.pygments .tok-nb { color: #336666 } /* Name.Builtin */
pre.pygments .tok-nc { color: #00AA88; font-weight: bold } /* Name.Class */
pre.pygments .tok-no { color: #336600 } /* Name.Constant */
pre.pygments .tok-nd { color: #9999FF } /* Name.Decorator */
pre.pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
pre.pygments .tok-ne { color: #CC0000; font-weight: bold } /* Name.Exception */
pre.pygments .tok-nf { color: #CC00FF } /* Name.Function */
pre.pygments .tok-nl { color: #9999FF } /* Name.Label */
pre.pygments .tok-nn { color: #00CCFF; font-weight: bold } /* Name.Namespace */
pre.pygments .tok-nt { color: #330099; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #003333 } /* Name.Variable */
pre.pygments .tok-ow { color: #000000; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
pre.pygments .tok-mb { color: #FF6600 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #FF6600 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #FF6600 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #FF6600 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #FF6600 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #CC3300 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #CC3300 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #CC3300 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #CC3300 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #CC3300; font-style: italic } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #CC3300 } /* Literal.String.Double */
pre.pygments .tok-se { color: #CC3300; font-weight: bold } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #CC3300 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #AA0000 } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #CC3300 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #33AAAA } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #CC3300 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #FFCC33 } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #336666 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #CC00FF } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #003333 } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #003333 } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #003333 } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #003333 } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #FF6600 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Εργασια Multimedia Streaming</h1>
<div class="details">
<span id="author" class="author">Χρήστος Βρέκος (Α.Μ. 21390027)</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Πίνακας περιεχομένων</div>
<ul class="sectlevel1">
<li><a href="#_aρχιτεκτονική_του_συστήματος">Aρχιτεκτονική του Συστήματος</a>
<ul class="sectlevel2">
<li><a href="#_streaming_server">Streaming Server</a>
<ul class="sectlevel3">
<li><a href="#_server_class">Server.class</a></li>
<li><a href="#_clienthandler_class">ClientHandler.class</a></li>
<li><a href="#_videomanager_class">VideoManager.class</a>
<ul class="sectlevel4">
<li><a href="#_initialize">Initialize()</a></li>
<li><a href="#_file_locks">File Locks</a></li>
<li><a href="#_ffmpeg_transcoding">FFMPEG Transcoding</a></li>
<li><a href="#_adaptive_streaming_with_hls">Adaptive Streaming with HLS</a></li>
<li><a href="#_streaming_video">Streaming Video</a></li>
<li><a href="#_dynamic_port_allocation">Dynamic Port Allocation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_streaming_client">Streaming Client</a>
<ul class="sectlevel3">
<li><a href="#_μέθοδος_start">Μέθοδος start()</a></li>
<li><a href="#_επικοινωνία_με_τον_server">Επικοινωνία με τον Server</a></li>
<li><a href="#_updatevideoliststring">updateVideoList(String)</a></li>
<li><a href="#_playstreamint_string_string">playStream(int, String, String)</a></li>
<li><a href="#_αυτοματο_κλείσιμο_του_ffplay">Αυτοματο κλείσιμο του ffplay</a></li>
<li><a href="#_showmessagestring">showMessage(String)</a></li>
<li><a href="#_disconnect">disconnect()</a></li>
</ul>
</li>
<li><a href="#_παρουσίαση_του_τελικού_υλοποιημένου_συστήματος"><strong>Παρουσίαση του τελικού υλοποιημένου συστήματος:</strong></a>
<ul class="sectlevel3">
<li><a href="#_dockerfile"><strong>Dockerfile</strong></a></li>
<li><a href="#_docker_compose"><strong>docker compose</strong></a></li>
<li><a href="#_nginx_config"><strong>nginx config</strong></a></li>
<li><a href="#_εκτέλεση_του_συστήματος"><strong>Εκτέλεση του συστήματος:</strong></a></li>
<li><a href="#_screenshots_εκτελέσεων"><strong>Screenshots εκτελέσεων:</strong></a></li>
<li><a href="#_load_balanced_screenshots"><strong>Load balanced Screenshots:</strong></a></li>
</ul>
</li>
<li><a href="#_παρουσίαση_προβλημάτων_που_αντιμετωπίσαμε"><strong>Παρουσίαση προβλημάτων που αντιμετωπίσαμε</strong></a>
<ul class="sectlevel3">
<li><a href="#_σερβιρισμα_βίντεο_σε_πολλαπλους_χρήστες"><strong>Σερβιρισμα βίντεο σε πολλαπλους χρήστες:</strong></a></li>
<li><a href="#_βελτίωση_της_λειτουργίας_απελευθέρωσης_κλειδώματος"><strong>Βελτίωση της λειτουργίας απελευθέρωσης κλειδώματος:</strong></a></li>
<li><a href="#_προβλήματα_με_την_αναπαραγωγή_βίντεο_μέσω_ffplay"><strong>Προβλήματα με την αναπαραγωγή βίντεο μέσω ffplay:</strong></a></li>
<li><a href="#_προβλήματα_με_την_υλοποιηση_adaptive_streaming"><strong>Προβλήματα με την υλοποιηση adaptive streaming:</strong></a></li>
<li><a href="#_προβλήματα_με_την_υλοποιηση_load_balancing"><strong>Προβλήματα με την υλοποιηση Load balancing:</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_aρχιτεκτονική_του_συστήματος"><a class="anchor" href="#_aρχιτεκτονική_του_συστήματος"></a><a class="link" href="#_aρχιτεκτονική_του_συστήματος">Aρχιτεκτονική του Συστήματος</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Περιγραφή του συστήματος και των λειτουργιών του:</strong><br>
Το σύστημα αποτελείται από δύο κύριες εφαρμογές οι οποιες χωριζονται σε 4 κλασεις ωστε ο κωδικας να ειναι πιο οργανωμένος και κατανοητός</p>
</div>
<div class="sect2">
<h3 id="_streaming_server"><a class="anchor" href="#_streaming_server"></a><a class="link" href="#_streaming_server">Streaming Server</a></h3>
<div class="paragraph">
<p>O streaming server υλοποιηθηκε ωστε να μπορει να υποστηρίζει πολλους clients ταυτοχρονα και να ειναι multithreaded. Ο server ειναι υπευθυνος για την διαχειριση των βιντεο και την μετατροπη τους σε διαφορετικες αναλυσεις και φορμες μεσω του FFmpeg. Επικοινωνει με τον client μεσω Java Sockets και εχει τις εξης κλασεις:</p>
</div>
<div class="sect3">
<h4 id="_server_class"><a class="anchor" href="#_server_class"></a><a class="link" href="#_server_class">Server.class</a></h4>
<div class="paragraph">
<p>Υλοποιεί την κλάση του server, διαχειρίζεται τις συνδέσεις και τις ροές δεδομένων (input/output streams).</p>
</div>
<div class="paragraph">
<p>Συγκεκριμενα χρησιμοποιεί thread pool για να μπορει να διαχειριζεται πολλαπλους clients ταυτοχρονα. Ο server μπορει να γινει initiate σε οποια πορτα θελουμε με την default να ειναι η 5058.Αυτο γινεται ωστε να υπαρχει δυνατοτητα λειτουργειας load balancing με την εκτελεση πολλαπλων server σε διαφορετικες πορτες και παρακατω φενεται ο κωδικας που μας δινει την δυνατοτητα αυτη.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">DEFAULT_SERVER_ID</span><span class="tok-w">   </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;1&quot;</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">DEFAULT_SERVER_PORT</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;5058&quot;</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">DEFAULT_VIDEO_PATH</span><span class="tok-w">  </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;/home/chris/OneDrive/Documents/8o examino/Multimedia/multisrv/videos&quot;</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">DEFAULT_FFMPEG_PATH</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;/usr/bin&quot;</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">SERVER_ID</span><span class="tok-w">   </span><span class="tok-o">=</span>
<span class="tok-w">            </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">getenv</span><span class="tok-p">().</span><span class="tok-na">getOrDefault</span><span class="tok-p">(</span><span class="tok-s">&quot;SERVER_ID&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">DEFAULT_SERVER_ID</span><span class="tok-p">);</span>

<span class="tok-w">        </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">SERVER_PORT</span><span class="tok-w">   </span><span class="tok-o">=</span>
<span class="tok-w">            </span><span class="tok-n">Integer</span><span class="tok-p">.</span><span class="tok-na">parseInt</span><span class="tok-p">(</span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">getenv</span><span class="tok-p">().</span><span class="tok-na">getOrDefault</span><span class="tok-p">(</span><span class="tok-s">&quot;SERVER_PORT&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">DEFAULT_SERVER_PORT</span><span class="tok-p">));</span>

<span class="tok-w">        </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">VIDEO_PATH</span><span class="tok-w"> </span><span class="tok-o">=</span>
<span class="tok-w">            </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">getenv</span><span class="tok-p">().</span><span class="tok-na">getOrDefault</span><span class="tok-p">(</span><span class="tok-s">&quot;VIDEO_PATH&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">DEFAULT_VIDEO_PATH</span><span class="tok-p">);</span>

<span class="tok-w">        </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">FFMPEG_PATH</span><span class="tok-w"> </span><span class="tok-o">=</span>
<span class="tok-w">            </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">getenv</span><span class="tok-p">().</span><span class="tok-na">getOrDefault</span><span class="tok-p">(</span><span class="tok-s">&quot;FFMPEG_PATH&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">DEFAULT_FFMPEG_PATH</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Επειτα απο την δημιουργία του socket εκετελειτε η function initialize του VideoManager και μετα ο Server αναμενει connections απο τους clients. Οταν ενας client συνδεθεί, με την χρηση της συναρτησης handleNewConnection αποδεσμευει σε ενα Thread τον Client με την κλάση ClientHandler. Οταν ο client αποσυνδεθεί, η χρηση ενος anonymous class που υλοποιει το Runnable interface, καλεί την συναρτηση disconnectCallback.run() και ετσι μπορουμε να μειωσουμε τον αριθμο των ενεργων συνδεσεων. Εδω γινεται χρηση ενος atomic integer για να μπορουμε να εχουμε ταυτόχρονες προσβάσεις απο πολλα instaces χωρις να υπαρχει race condition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">AtomicInteger</span><span class="tok-w"> </span><span class="tok-n">activeConnections</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">AtomicInteger</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">....</span>
<span class="tok-w">                 </span><span class="tok-n">clientPool</span><span class="tok-p">.</span><span class="tok-na">submit</span><span class="tok-p">(</span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">ClientHandler</span><span class="tok-p">(</span><span class="tok-n">clientSocket</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">output</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">videoManager</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">activeConnections</span><span class="tok-p">.</span><span class="tok-na">decrementAndGet</span><span class="tok-p">();</span>
<span class="tok-w">                </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Client disconnected. Active connections: &quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">activeConnections</span><span class="tok-p">.</span><span class="tok-na">get</span><span class="tok-p">());</span>
<span class="tok-w">            </span><span class="tok-p">}));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Τελος η κλάση Server εχει και την συναρτηση shutdownHook που ειναι υπευθυνη για την ομαλη διακοπη του server και την απελευθερωση των πόρων του.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-w"> </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">registerShutdownHook</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">Runtime</span><span class="tok-p">.</span><span class="tok-na">getRuntime</span><span class="tok-p">().</span><span class="tok-na">addShutdownHook</span><span class="tok-p">(</span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">Thread</span><span class="tok-p">(()</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;Shutting down server...&quot;</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-n">clientPool</span><span class="tok-p">.</span><span class="tok-na">shutdown</span><span class="tok-p">();</span>
<span class="tok-w">            </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">clientPool</span><span class="tok-p">.</span><span class="tok-na">awaitTermination</span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">TimeUnit</span><span class="tok-p">.</span><span class="tok-na">SECONDS</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-n">clientPool</span><span class="tok-p">.</span><span class="tok-na">shutdownNow</span><span class="tok-p">();</span>
<span class="tok-w">                </span><span class="tok-p">}</span>
<span class="tok-w">            </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">InterruptedException</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">clientPool</span><span class="tok-p">.</span><span class="tok-na">shutdownNow</span><span class="tok-p">();</span>
<span class="tok-w">            </span><span class="tok-p">}</span>
<span class="tok-w">            </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;Server shutdown complete&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-p">}));</span>
<span class="tok-w">    </span><span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clienthandler_class"><a class="anchor" href="#_clienthandler_class"></a><a class="link" href="#_clienthandler_class">ClientHandler.class</a></h4>
<div class="paragraph">
<p>Υλοποιεί την κλάση που διαχειρίζεται τις συνδέσεις με τους πελάτες, επεξεργάζεται τις εντολές και στέλνει τα δεδομένα (Streaming).</p>
</div>
<div class="paragraph">
<p>Η κλάση αυτη ειναι υπευθυνη για την διαχείριση των clients και την επεξεργασία των εντολών τους. Οταν ο client συνδεθεί, η κλάση ClientHandler αναλαμβάνει να διαχειριστεί την επικοινωνία με τον client. H κλάση ClientHandler εχει την συναρτηση processCommand που ειναι υπευθυνη για την επεξεργασία των εντολών του client απο το Terminal. Οταν ο client στείλει μια εντολή, η κλάση ClientHandler θα την επεξεργαστεί και θα επιστρέψει τα αποτελέσματα στον client. Η κλάση αυτη καλει συναρτησεις της κλασης VideoManager για να παρουσιασει την λιστα με τα διαθεσιμα βιντεο στον client.H  proccessCommand διαχειριζεται εντολες τυπου CLI εφοσων η αρχικη υλοποιηση του client ηταν ενα terminal executable. Οταν αναπτυχθυκε το GUI, για την απλοτητα τησ εφαρμογης, διατηρηθηκε η επικοινωνεια με τις εντολες τυπου CLI μεσα απο το Java socket. Η οποια πειρεχει 3 εντολες:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>LIST: Επιστρέφει την λίστα με τα διαθέσιμα βίντεο εκτελοντας την συναρτηση getVideoList του VideoManager.</p>
</li>
<li>
<p>GET &lt;video_name&gt;: Επιστρέφει πληροφορίες για το συγκεκριμένο βίντεο εκτελοντας την συναρτηση playVideo του getVideoInfo.</p>
</li>
<li>
<p>PLAY &lt;video_name&gt; &lt;quality&gt; &lt;format&gt;: Ξεκινάει την ροή του συγκεκριμένου βίντεο με την επιλεγμένη ποιότητα εκτελοντας την συναρτηση playVideo του VideoManager .</p>
</li>
<li>
<p>Bye: Κλείνει την σύνδεση με τον server.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_videomanager_class"><a class="anchor" href="#_videomanager_class"></a><a class="link" href="#_videomanager_class">VideoManager.class</a></h4>
<div class="paragraph">
<p>Υλοποιεί την κλάση που διαχειρίζεται τα βίντεο, τις μετατροπές και τις ροές.</p>
</div>
<div class="paragraph">
<p>Η κλαση αυτη ειναι υπευθυνη για την διαχείριση των βίντεο και την μετατροπή τους σε διαφορετικές αναλύσεις και formats μεσω του FFmpeg. Η κλάση VideoManager επισης βοηθεια με getters ωστε να μπορουμε να εχουμε πληροφορίες για τα βίντεο που εχουμε δημιουργησει. Τα οποια χρησιμοποιουνται απο την κλάση ClientHandler για να παρουσιασουν την λιστα με τα διαθεσιμα βιντεο στον client.</p>
</div>
<div class="sect4">
<h5 id="_initialize"><a class="anchor" href="#_initialize"></a><a class="link" href="#_initialize">Initialize()</a></h5>
<div class="paragraph">
<p>Η πρωτη συναρτηση που καλείται ειναι η initialize που φορτώνει τα βίντεο απο τον καταλογο που του δινουμε και τα αποθηκευει σε μια λιστα. Επειτα κανει ελεγχω για ποιος συνδιασμος απο τα προτοκολλα και αναλυσης που υποστηριζει η εφαρμογη μας δεν υπαρχουν στην λιστα αλλα μονο για αναλυσησεις μικροτερεσ τησ αρχικησ που βρεθηκε. Ετσι μπορει να δημιουργησει τα βίντεο που λειπουν με την συναρτηση analyzeMissingFormats. Η σειρα κλησεων ειναι η εξης: indexVideoFiles → analyzeMissingFormats → generateAllHLSPlaylists → indexVideoFiles</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">initialize</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;Initializing video manager...&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">File</span><span class="tok-w"> </span><span class="tok-n">videoDir</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">getVideoDirectory</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">videoDir</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">error</span><span class="tok-p">(</span><span class="tok-s">&quot;Failed to initialize video manager&quot;</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-k">return</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-p">}</span>

<span class="tok-w">        </span><span class="tok-c1">// First index videos, then analyze and create missing formats</span>
<span class="tok-w">        </span><span class="tok-n">indexVideoFiles</span><span class="tok-p">(</span><span class="tok-n">videoDir</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">analyzeMissingFormats</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-c1">// Generate HLS playlists for all videos</span>
<span class="tok-w">        </span><span class="tok-n">generateAllHLSPlaylists</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-c1">// Re-index after all operations</span>
<span class="tok-w">        </span><span class="tok-n">indexVideoFiles</span><span class="tok-p">(</span><span class="tok-n">videoDir</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;Video manager initialized successfully&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_locks"><a class="anchor" href="#_file_locks"></a><a class="link" href="#_file_locks">File Locks</a></h5>
<div class="paragraph">
<p>Η κλάση VideoManager εχει και συναρτησεις  που ειναι υπευθυνες για την διαχειριση των File Lock και την αποφυγή ταυτόχρονων προσβάσεων στα βίντεο. Αυτη υλοποιηθηκαν ωστε να υπαρχει δυνατοτητα εκτελεσεις πολλαπλων instances του server, οι οποιοι κανουν Load balance μεταξυ τους.</p>
</div>
<div class="paragraph">
<p>Ετσι οταν ενας server θελει να μετατρεψει ενα βιντεο σε μια συγκεκριμένη αναλυση και φορματ, καλεί την συναρτηση acquireLock και αν το lock εχει αποκτηθεί, τοτε προχωραει στην μετατροπή του βίντεο. Αν το lock δεν εχει αποκτηθεί, τοτε η συναρτηση επιστρέφει false και ο server δεν προχωραει στην μετατροπή του βίντεο. Ετσι αποφεύγουμε ταυτόχρονες προσβάσεις στα βίντεο και διασφαλιζουμε την ακεραιοτητα τους. Παρακατω υπαχει ενα παραδειγμα απο δοκιμη που εγινε με docker ωστε να τρεξουμε παραλληλα 2 instances του servrer και να δουμε οτι δεν υπαρχει προβλημα με τα File Lock και για τις αναγκεσ load balancing της εφαρμογης:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">multimedia-server-1-1  | ANALYZING MISSING FORMATS THAT COULD BE CREATED WITH FFMPEG:</span>
<span class="tok-go">multimedia-server-1-1  | 23:32:37.248 [main] INFO  com.multisrv.VideoManager -   Missing: input_fish-144p.avi</span>
<span class="tok-go">multimedia-server-1-1  | 23:32:37.251 [main] INFO  com.multisrv.VideoManager - Converting: input_fish-1080p.mp4 -&gt; input_fish-144p.avi</span>
<span class="tok-go">multimedia-server-2-1  | 23:32:37.253 [main] INFO  com.multisrv.Server - Server 2 running on port 5059</span>
<span class="tok-go">multimedia-server-2-1  | ANALYZING MISSING FORMATS THAT COULD BE CREATED WITH FFMPEG:</span>
<span class="tok-go">multimedia-server-2-1  | 23:32:37.268 [main] INFO  com.multisrv.VideoManager -   Missing: input_fish-144p.avi</span>
<span class="tok-go">multimedia-server-2-1  | 23:32:37.269 [main] INFO  com.multisrv.VideoManager - Conversion already in progress by another instance: input_fish-144p.avi</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ffmpeg_transcoding"><a class="anchor" href="#_ffmpeg_transcoding"></a><a class="link" href="#_ffmpeg_transcoding">FFMPEG Transcoding</a></h5>
<div class="paragraph">
<p>Εκτος απο την διχειρειση των lock files η κλαση VideoManager θεωρειται το βασικο backend τις streaming εφαμογης μας στο Server side. Αρχικα φορτώνει τα βίντεο απο τον καταλογο που του δινουμε και τα αποθηκευει σε μια λιστα.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">videoQualities</span><span class="tok-p">.</span><span class="tok-na">computeIfAbsent</span><span class="tok-p">(</span><span class="tok-n">baseName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">k</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-n">ConcurrentHashMap</span><span class="tok-p">.</span><span class="tok-na">newKeySet</span><span class="tok-p">()).</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-n">quality</span><span class="tok-p">);</span>
<span class="tok-n">videoFormats</span><span class="tok-p">.</span><span class="tok-na">computeIfAbsent</span><span class="tok-p">(</span><span class="tok-n">baseName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">k</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-n">ConcurrentHashMap</span><span class="tok-p">.</span><span class="tok-na">newKeySet</span><span class="tok-p">()).</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-n">format</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Εδω γινεται χρηση των ConcurrentHashMap ετσι ωστε να μπορουμε να εχουμε ταυτόχρονες προσβάσεις απο πολλα instaces χωρις να υπαρχει race condition.
Επειτα κανει ελεγχω για ποιος συνδιασμος απο τα προτοκολλα και αναλυσης που υποστηριζει η εφαρμογη μας δεν υπαρχουν στην λιστα αλλα μονο για αναλυσησεις μικροτερεσ τησ αρχικησ που βρεθηκε.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">analyzeMissingFormats</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-p">....</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">highestQuality</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">findHighestQuality</span><span class="tok-p">(</span><span class="tok-n">videoQualities</span><span class="tok-p">.</span><span class="tok-na">get</span><span class="tok-p">(</span><span class="tok-n">videoName</span><span class="tok-p">));</span>
<span class="tok-p">....</span>
<span class="tok-p">}</span>
<span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-nf">findHighestQuality</span><span class="tok-p">(</span><span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">qualities</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">highestIndex</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">highestQuality</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">quality</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">qualities</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">index</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">supportedQualities</span><span class="tok-p">.</span><span class="tok-na">indexOf</span><span class="tok-p">(</span><span class="tok-n">quality</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">index</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">highestIndex</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">highestIndex</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">index</span><span class="tok-p">;</span>
<span class="tok-w">                </span><span class="tok-n">highestQuality</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">quality</span><span class="tok-p">;</span>
<span class="tok-w">            </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">highestQuality</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Επειτα εχουμε ενα αποσπασμα της διαδικασιας δημιουργιας των βιντεο που λειποουν. Καποια μερη των σηναρτησεων παραληπονται για ευαναγνωσία.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">analyzeMissingFormats</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-p">....</span>
<span class="tok-w">  </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-o">&lt;=</span><span class="tok-w"> </span><span class="tok-n">highestQualityIndex</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">quality</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">supportedQualities</span><span class="tok-p">.</span><span class="tok-na">get</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">format</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">supportedFormats</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">videoExists</span><span class="tok-p">(</span><span class="tok-n">videoName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">quality</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">format</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                        </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;  Missing: {}-{}.{}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">videoName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">quality</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">format</span><span class="tok-p">);</span>
<span class="tok-w">                        </span><span class="tok-n">generateVideoFormat</span><span class="tok-p">(</span><span class="tok-n">videoName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">quality</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">format</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">highestQuality</span><span class="tok-p">);</span>
<span class="tok-w">                        </span><span class="tok-p">....</span>
<span class="tok-w">                    </span><span class="tok-p">}</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">generateVideoFormat</span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">videoName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">targetQuality</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">targetFormat</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">sourceQuality</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">videoExists</span><span class="tok-p">(</span><span class="tok-n">videoName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">targetQuality</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">targetFormat</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-p">....</span>
<span class="tok-w">        </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">acquireLock</span><span class="tok-p">(</span><span class="tok-n">videoName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">targetQuality</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">targetFormat</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-p">....</span>
<span class="tok-w">        </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">File</span><span class="tok-w"> </span><span class="tok-n">videoDir</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">getVideoDirectory</span><span class="tok-p">();</span>
<span class="tok-w">            </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">sourceFormat</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">findBestSourceFormat</span><span class="tok-p">(</span><span class="tok-n">videoName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">sourceQuality</span><span class="tok-p">);</span>

<span class="tok-w">            </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">sourceFormat</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">error</span><span class="tok-p">(</span><span class="tok-s">&quot;No suitable source format found for {}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">videoName</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-k">return</span><span class="tok-p">;</span>
<span class="tok-w">            </span><span class="tok-p">}</span>

<span class="tok-w">            </span><span class="tok-n">File</span><span class="tok-w"> </span><span class="tok-n">sourceFile</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">File</span><span class="tok-p">(</span><span class="tok-n">videoDir</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">videoName</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;-&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">sourceQuality</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;.&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">sourceFormat</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-n">File</span><span class="tok-w"> </span><span class="tok-n">targetFile</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">File</span><span class="tok-p">(</span><span class="tok-n">videoDir</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">videoName</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;-&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">targetQuality</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;.&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">targetFormat</span><span class="tok-p">);</span>

<span class="tok-w">            </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;Converting: {} -&gt; {}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">sourceFile</span><span class="tok-p">.</span><span class="tok-na">getName</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">targetFile</span><span class="tok-p">.</span><span class="tok-na">getName</span><span class="tok-p">());</span>
<span class="tok-w">            </span><span class="tok-n">transcodeFFMPEG</span><span class="tok-p">(</span><span class="tok-n">sourceFile</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">targetFile</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">targetQuality</span><span class="tok-p">);</span>

<span class="tok-w">            </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">targetFile</span><span class="tok-p">.</span><span class="tok-na">exists</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;Conversion successful: {}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">targetFile</span><span class="tok-p">.</span><span class="tok-na">getName</span><span class="tok-p">());</span>
<span class="tok-w">                </span><span class="tok-n">parseVideoFile</span><span class="tok-p">(</span><span class="tok-n">targetFile</span><span class="tok-p">.</span><span class="tok-na">getName</span><span class="tok-p">());</span>
<span class="tok-w">            </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Τελος η transcodeFFMPEG ειναι η συναρτηση που καλει το FFmpeg μεσω του Jaffree για να κανει την μετατροπη του βίντεο. Καποια μερη της περιλαβανονται στο παρακατω αποσπασμα οπως η μεταφορα του πινακα με τις αναλογιες bitrate και αναλυσεις που μας δοθηκε στην εκφωνηση σε κωδικα:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">transcodeFFMPEG</span><span class="tok-p">(</span><span class="tok-n">File</span><span class="tok-w"> </span><span class="tok-n">sourceFile</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">File</span><span class="tok-w"> </span><span class="tok-n">targetFile</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">targetQuality</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">targetFormat</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">targetFile</span><span class="tok-p">.</span><span class="tok-na">getName</span><span class="tok-p">().</span><span class="tok-na">substring</span><span class="tok-p">(</span><span class="tok-n">targetFile</span><span class="tok-p">.</span><span class="tok-na">getName</span><span class="tok-p">().</span><span class="tok-na">lastIndexOf</span><span class="tok-p">(</span><span class="tok-sc">&#39;.&#39;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">targetHeight</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-p">.</span><span class="tok-na">parseInt</span><span class="tok-p">(</span><span class="tok-n">targetQuality</span><span class="tok-p">.</span><span class="tok-na">replace</span><span class="tok-p">(</span><span class="tok-s">&quot;p&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;&quot;</span><span class="tok-p">));</span>

<span class="tok-w">            </span><span class="tok-c1">// Determine bitrate based on quality</span>
<span class="tok-w">            </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-p">;</span>
<span class="tok-w">            </span><span class="tok-k">switch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">targetQuality</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;1080p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;5000k&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;720p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;2500k&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;480p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;1500k&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;360p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;1000k&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;240p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;700k&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;144p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;400k&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                </span><span class="tok-k">default</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;1000k&quot;</span><span class="tok-p">;</span>
<span class="tok-w">            </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Παρακατω βρισκεται και ο κωδικας για την δημιουργεια του FFmpeg command που θα εκτελεστεί για την μετατροπή του βίντεο:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-w">            </span><span class="tok-c1">// Log the FFmpeg command to be executed</span>
<span class="tok-w">            </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;FFmpeg command: ffmpeg -i {} -vf scale=-2:{} -c:v libx264 -b:v {} -preset medium {}&quot;</span><span class="tok-p">,</span>
<span class="tok-w">                        </span><span class="tok-n">sourceFile</span><span class="tok-p">.</span><span class="tok-na">getAbsolutePath</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">targetHeight</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">targetFile</span><span class="tok-p">.</span><span class="tok-na">getAbsolutePath</span><span class="tok-p">());</span>

<span class="tok-w">            </span><span class="tok-c1">// Build the FFmpeg command</span>
<span class="tok-w">            </span><span class="tok-n">FFmpeg</span><span class="tok-w"> </span><span class="tok-n">ffmpeg</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">FFmpeg</span><span class="tok-p">.</span><span class="tok-na">atPath</span><span class="tok-p">()</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">addInput</span><span class="tok-p">(</span><span class="tok-n">UrlInput</span><span class="tok-p">.</span><span class="tok-na">fromPath</span><span class="tok-p">(</span><span class="tok-n">sourceFile</span><span class="tok-p">.</span><span class="tok-na">toPath</span><span class="tok-p">()))</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">setFilter</span><span class="tok-p">(</span><span class="tok-n">StreamType</span><span class="tok-p">.</span><span class="tok-na">VIDEO</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;scale=-2:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">targetHeight</span><span class="tok-p">)</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">addArguments</span><span class="tok-p">(</span><span class="tok-s">&quot;-c:v&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;libx264&quot;</span><span class="tok-p">)</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">addArguments</span><span class="tok-p">(</span><span class="tok-s">&quot;-b:v&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-p">)</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">addArguments</span><span class="tok-p">(</span><span class="tok-s">&quot;-preset&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;medium&quot;</span><span class="tok-p">)</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">setOverwriteOutput</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

<span class="tok-w">            </span><span class="tok-n">UrlOutput</span><span class="tok-w"> </span><span class="tok-n">output</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">UrlOutput</span><span class="tok-p">.</span><span class="tok-na">toPath</span><span class="tok-p">(</span><span class="tok-n">targetFile</span><span class="tok-p">.</span><span class="tok-na">toPath</span><span class="tok-p">());</span>
<span class="tok-w">            </span><span class="tok-n">output</span><span class="tok-p">.</span><span class="tok-na">addArguments</span><span class="tok-p">(</span><span class="tok-s">&quot;-c:a&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;aac&quot;</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-n">ffmpeg</span><span class="tok-p">.</span><span class="tok-na">addOutput</span><span class="tok-p">(</span><span class="tok-n">output</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_adaptive_streaming_with_hls"><a class="anchor" href="#_adaptive_streaming_with_hls"></a><a class="link" href="#_adaptive_streaming_with_hls">Adaptive Streaming with HLS</a></h5>
<div class="paragraph">
<p>Η κλαση VideoManager εχει και την δυνατοτητα δημιουργιας HLS playlist για adaptive streaming. Η δημιουργια του HLS playlist γινεται με την συναρτηση createHLSPlaylist που δημιουργει ενα m3u8 αρχείο με τις διαφορετικές αναλύσεις και φορμάτ των βίντεο αλλα και με την δημιουργεια των .ts αρχείων για κάθε ανάλυση. Παρακάτω παρατίθεται ενα μερος του κώδικα που υλοποιεί την δημιουργία του HLS playlist:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">quality</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">sortedQualities</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">height</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-p">.</span><span class="tok-na">parseInt</span><span class="tok-p">(</span><span class="tok-n">quality</span><span class="tok-p">.</span><span class="tok-na">replace</span><span class="tok-p">(</span><span class="tok-s">&quot;p&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;&quot;</span><span class="tok-p">));</span>
<span class="tok-w">                </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-p">;</span>

<span class="tok-w">                </span><span class="tok-c1">// Determine appropriate bitrate based on resolution</span>
<span class="tok-w">                </span><span class="tok-k">switch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">quality</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;1080p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;4500k&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;720p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;2500k&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;480p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;1000k&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;360p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;750k&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;240p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;400k&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;144p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;250k&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-k">default</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;750k&quot;</span><span class="tok-p">;</span>
<span class="tok-w">                </span><span class="tok-p">}</span>

<span class="tok-w">                </span><span class="tok-n">File</span><span class="tok-w"> </span><span class="tok-n">qualityDir</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">File</span><span class="tok-p">(</span><span class="tok-n">hlsDir</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">quality</span><span class="tok-p">);</span>

<span class="tok-w">                </span><span class="tok-c1">// Create individual HLS stream for this quality</span>
<span class="tok-w">                </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">command</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">ArrayList</span><span class="tok-o">&lt;&gt;</span><span class="tok-p">();</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;ffmpeg&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-i&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-n">sourceFile</span><span class="tok-p">.</span><span class="tok-na">getAbsolutePath</span><span class="tok-p">());</span>

<span class="tok-w">                </span><span class="tok-c1">// Force keyframes every 2 seconds for proper segmentation</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-force_key_frames&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;expr:gte(t,n_forced*2)&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-sc_threshold&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;0&quot;</span><span class="tok-p">);</span>

<span class="tok-w">                </span><span class="tok-c1">// Video settings</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-c:v&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;libx264&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-preset&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;veryfast&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-profile:v&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;main&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-crf&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;23&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-maxrate&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-n">bitrate</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-bufsize&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-n">bitrate</span><span class="tok-p">.</span><span class="tok-na">replace</span><span class="tok-p">(</span><span class="tok-s">&quot;k&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;000&quot;</span><span class="tok-p">));</span>

<span class="tok-w">                </span><span class="tok-c1">// Proper filter syntax</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-vf&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;scale=-2:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">height</span><span class="tok-p">);</span>

<span class="tok-w">                </span><span class="tok-c1">// Audio settings</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-c:a&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;aac&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-b:a&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;128k&quot;</span><span class="tok-p">);</span>

<span class="tok-w">                </span><span class="tok-c1">// HLS settings - IMPORTANT CHANGES HERE</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-f&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;hls&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-hls_time&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;4&quot;</span><span class="tok-p">);</span><span class="tok-w">  </span><span class="tok-c1">// 4-second segments</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-hls_list_size&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;0&quot;</span><span class="tok-p">);</span><span class="tok-w">  </span><span class="tok-c1">// Include ALL segments in the playlist</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-hls_flags&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;split_by_time+independent_segments&quot;</span><span class="tok-p">);</span><span class="tok-w"> </span><span class="tok-c1">// Removed delete_segments flag</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-hls_segment_type&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;mpegts&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-hls_segment_filename&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">File</span><span class="tok-p">(</span><span class="tok-n">qualityDir</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;segment_%03d.ts&quot;</span><span class="tok-p">).</span><span class="tok-na">getAbsolutePath</span><span class="tok-p">());</span>

<span class="tok-w">                </span><span class="tok-c1">// Output file</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">File</span><span class="tok-p">(</span><span class="tok-n">qualityDir</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;stream.m3u8&quot;</span><span class="tok-p">).</span><span class="tok-na">getAbsolutePath</span><span class="tok-p">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Παρατηρουμαι οτι στον παραπάνω κώδικα, χρησημοποιουνται οι κλασσικες ρυθμισεις του FFmpeg για την δημιουργια του HLS playlist. Η εντολη force_key_frames χρησιμοποιειται για να διασφαλιστεί οτι θα υπαρχει ομαλη εναλλαγή μεταξύ των διαφορετικών αναλύσεων εν ωρα streaming. Το οποιο δεν ελιτουργουσε σωστα στην αρχικη υλοποιηση και ετσι προσθεσαμε την παραπάνω εντολη. Επίσης, η ρύθμιση hls_flags με την τιμή split_by_time+independent_segments διασφαλίζει ότι τα τμήματα θα είναι ανεξάρτητα και θα μπορούν να αναπαράγονται αυτόνομα, χωρίς να απαιτείται το προηγούμενο τμήμα.</p>
</div>
<div class="paragraph">
<p>Στην συνεχεια η κλαση δημιουργει το m3u8 αρχείο με τις πληροφορίες για τα bitrates και τις αναλύσεις. Αυτο γινεται στον παρακατω κώδικα:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-w"> </span><span class="tok-c1">// Create the master playlist after all quality streams have been generated</span>
<span class="tok-w">        </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">StringBuilder</span><span class="tok-w"> </span><span class="tok-n">masterContent</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">StringBuilder</span><span class="tok-p">();</span>
<span class="tok-w">            </span><span class="tok-n">masterContent</span><span class="tok-p">.</span><span class="tok-na">append</span><span class="tok-p">(</span><span class="tok-s">&quot;#EXTM3U\n&quot;</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-n">masterContent</span><span class="tok-p">.</span><span class="tok-na">append</span><span class="tok-p">(</span><span class="tok-s">&quot;#EXT-X-VERSION:3\n&quot;</span><span class="tok-p">);</span>

<span class="tok-w">            </span><span class="tok-c1">// Add each quality variant</span>
<span class="tok-w">            </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">quality</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">sortedQualities</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">height</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-p">.</span><span class="tok-na">parseInt</span><span class="tok-p">(</span><span class="tok-n">quality</span><span class="tok-p">.</span><span class="tok-na">replace</span><span class="tok-p">(</span><span class="tok-s">&quot;p&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;&quot;</span><span class="tok-p">));</span>
<span class="tok-w">                </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-p">;</span>

<span class="tok-w">                </span><span class="tok-c1">// Determine bitrate in bits/sec (not kbps)</span>
<span class="tok-w">                </span><span class="tok-k">switch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">quality</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;1080p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;4500000&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;720p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;2500000&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;480p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;1000000&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;360p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;750000&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;240p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;400000&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;144p&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;250000&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-k">default</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">bitrate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;750000&quot;</span><span class="tok-p">;</span>
<span class="tok-w">                </span><span class="tok-p">}</span>

<span class="tok-w">                </span><span class="tok-c1">// Check if this quality&#39;s stream exists</span>
<span class="tok-w">                </span><span class="tok-n">File</span><span class="tok-w"> </span><span class="tok-n">streamFile</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">File</span><span class="tok-p">(</span><span class="tok-n">hlsDir</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">quality</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;/stream.m3u8&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">streamFile</span><span class="tok-p">.</span><span class="tok-na">exists</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">width</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-p">)((</span><span class="tok-kt">double</span><span class="tok-p">)</span><span class="tok-n">height</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-mi">16</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-mi">9</span><span class="tok-p">);</span><span class="tok-w"> </span><span class="tok-c1">// Assume 16:9 aspect ratio</span>
<span class="tok-w">                    </span><span class="tok-n">masterContent</span><span class="tok-p">.</span><span class="tok-na">append</span><span class="tok-p">(</span><span class="tok-s">&quot;#EXT-X-STREAM-INF:BANDWIDTH=&quot;</span><span class="tok-p">).</span><span class="tok-na">append</span><span class="tok-p">(</span><span class="tok-n">bitrate</span><span class="tok-p">)</span>
<span class="tok-w">                               </span><span class="tok-p">.</span><span class="tok-na">append</span><span class="tok-p">(</span><span class="tok-s">&quot;,RESOLUTION=&quot;</span><span class="tok-p">).</span><span class="tok-na">append</span><span class="tok-p">(</span><span class="tok-n">width</span><span class="tok-p">).</span><span class="tok-na">append</span><span class="tok-p">(</span><span class="tok-s">&quot;x&quot;</span><span class="tok-p">).</span><span class="tok-na">append</span><span class="tok-p">(</span><span class="tok-n">height</span><span class="tok-p">)</span>
<span class="tok-w">                               </span><span class="tok-p">.</span><span class="tok-na">append</span><span class="tok-p">(</span><span class="tok-s">&quot;,NAME=\&quot;&quot;</span><span class="tok-p">).</span><span class="tok-na">append</span><span class="tok-p">(</span><span class="tok-n">quality</span><span class="tok-p">).</span><span class="tok-na">append</span><span class="tok-p">(</span><span class="tok-s">&quot;\&quot;\n&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                    </span><span class="tok-n">masterContent</span><span class="tok-p">.</span><span class="tok-na">append</span><span class="tok-p">(</span><span class="tok-n">quality</span><span class="tok-p">).</span><span class="tok-na">append</span><span class="tok-p">(</span><span class="tok-s">&quot;/stream.m3u8\n&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-p">}</span>
<span class="tok-w">            </span><span class="tok-p">}</span>

<span class="tok-w">            </span><span class="tok-c1">// Write the master playlist</span>
<span class="tok-w">            </span><span class="tok-n">File</span><span class="tok-w"> </span><span class="tok-n">masterPlaylist</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">File</span><span class="tok-p">(</span><span class="tok-n">hlsDir</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;master.m3u8&quot;</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">FileWriter</span><span class="tok-w"> </span><span class="tok-n">writer</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">FileWriter</span><span class="tok-p">(</span><span class="tok-n">masterPlaylist</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">writer</span><span class="tok-p">.</span><span class="tok-na">write</span><span class="tok-p">(</span><span class="tok-n">masterContent</span><span class="tok-p">.</span><span class="tok-na">toString</span><span class="tok-p">());</span>
<span class="tok-w">            </span><span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_streaming_video"><a class="anchor" href="#_streaming_video"></a><a class="link" href="#_streaming_video">Streaming Video</a></h5>
<div class="paragraph">
<p>Η τελευταια κυρια λειτουργια της κλασης VideoManager ειναι η συναρτηση playVideo που ειναι υπευθυνη για την αναπαραγωγη του βίντεο με την επιλεγμένη ποιότητα και φορμάτ. Η συναρτηση αυτη καλει διαφορετικες συναρτησης αναλογα με το προτοκολλο μεταδοσης του βιντεο. Αρχικα δεχεται ως ορισμα το ονομα του βιντεο και το προτοκολλο μεταδοσης του. Επειτα με τον παρακατω κώδικα βρισκει βαση του ονοματος την επιθυμητη αναλυση και φορματ που εχει ζητηθει:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-w"> </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-nf">playVideo</span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">videoName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">protocol</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">File</span><span class="tok-w"> </span><span class="tok-n">videoDir</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">getVideoDirectory</span><span class="tok-p">();</span>

<span class="tok-w">            </span><span class="tok-c1">// Extract base name (videos sent from client might have quality/format)</span>
<span class="tok-w">            </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">baseName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">videoName</span><span class="tok-p">;</span>
<span class="tok-w">            </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">quality</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">;</span>
<span class="tok-w">            </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">format</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">;</span>

<span class="tok-w">            </span><span class="tok-c1">// Parse filename to extract quality and format if present</span>
<span class="tok-w">            </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">dashIdx</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">baseName</span><span class="tok-p">.</span><span class="tok-na">lastIndexOf</span><span class="tok-p">(</span><span class="tok-sc">&#39;-&#39;</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">dotIdx</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">baseName</span><span class="tok-p">.</span><span class="tok-na">lastIndexOf</span><span class="tok-p">(</span><span class="tok-sc">&#39;.&#39;</span><span class="tok-p">);</span>

<span class="tok-w">            </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">dashIdx</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-n">dotIdx</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">dashIdx</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">quality</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">baseName</span><span class="tok-p">.</span><span class="tok-na">substring</span><span class="tok-p">(</span><span class="tok-n">dashIdx</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">dotIdx</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">format</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">baseName</span><span class="tok-p">.</span><span class="tok-na">substring</span><span class="tok-p">(</span><span class="tok-n">dotIdx</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">baseName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">baseName</span><span class="tok-p">.</span><span class="tok-na">substring</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">dashIdx</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Επειτα η ροη τησ κλασης ειναι διαφορετικη αναλογα με το πρωτοκολλο μεταδοσης που εχει ζητηθει απο τον client.Σε περιπτωση που το πρωτοκολλο <strong>δεν</strong> ειναι HLS η εναρξη του stream αποφασιζεται απο το παρακατω switch case statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-w">            </span><span class="tok-c1">// Start streaming based on selected protocol</span>
<span class="tok-w">                </span><span class="tok-k">switch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">protocol</span><span class="tok-p">.</span><span class="tok-na">toUpperCase</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;TCP&quot;</span><span class="tok-p">:</span>
<span class="tok-w">                        </span><span class="tok-n">startTCPStream</span><span class="tok-p">(</span><span class="tok-n">videoFile</span><span class="tok-p">.</span><span class="tok-na">getAbsolutePath</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">streamPort</span><span class="tok-p">);</span>
<span class="tok-w">                        </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;RTP/UDP&quot;</span><span class="tok-p">:</span>
<span class="tok-w">                        </span><span class="tok-n">File</span><span class="tok-w"> </span><span class="tok-n">sdpFile</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">File</span><span class="tok-p">(</span><span class="tok-n">videoDir</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;stream_&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">streamPort</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;.sdp&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                        </span><span class="tok-n">startRTPStreamProcess</span><span class="tok-p">(</span><span class="tok-n">videoFile</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">streamPort</span><span class="tok-p">);</span>

<span class="tok-w">                        </span><span class="tok-c1">// Include the SDP content in the response (not just the path)</span>
<span class="tok-w">                        </span><span class="tok-c1">// Use Base64 encoding to safely transfer</span>
<span class="tok-w">                        </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                            </span><span class="tok-n">Thread</span><span class="tok-p">.</span><span class="tok-na">sleep</span><span class="tok-p">(</span><span class="tok-mi">200</span><span class="tok-p">);</span><span class="tok-w"> </span><span class="tok-c1">// Give the server a small time to generate the SDP</span>
<span class="tok-w">                        </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">InterruptedException</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                            </span><span class="tok-n">Thread</span><span class="tok-p">.</span><span class="tok-na">currentThread</span><span class="tok-p">().</span><span class="tok-na">interrupt</span><span class="tok-p">();</span>
<span class="tok-w">                        </span><span class="tok-p">}</span>

<span class="tok-w">                        </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">lastGeneratedSdpContent</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                            </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-s">&quot;STREAM:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">streamPort</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">videoFile</span><span class="tok-p">.</span><span class="tok-na">getName</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">protocol</span><span class="tok-w"> </span><span class="tok-o">+</span>
<span class="tok-w">                                   </span><span class="tok-s">&quot;:SDP:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">java</span><span class="tok-p">.</span><span class="tok-na">util</span><span class="tok-p">.</span><span class="tok-na">Base64</span><span class="tok-p">.</span><span class="tok-na">getEncoder</span><span class="tok-p">().</span><span class="tok-na">encodeToString</span><span class="tok-p">(</span><span class="tok-n">lastGeneratedSdpContent</span><span class="tok-p">.</span><span class="tok-na">getBytes</span><span class="tok-p">());</span>
<span class="tok-w">                        </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                            </span><span class="tok-c1">// Fallback to sending file path</span>
<span class="tok-w">                            </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-s">&quot;STREAM:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">streamPort</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">videoFile</span><span class="tok-p">.</span><span class="tok-na">getName</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">protocol</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">sdpFile</span><span class="tok-p">.</span><span class="tok-na">getAbsolutePath</span><span class="tok-p">();</span>
<span class="tok-w">                        </span><span class="tok-p">}</span>
<span class="tok-w">                    </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;UDP&quot;</span><span class="tok-p">:</span>
<span class="tok-w">                        </span><span class="tok-n">startUDPStream</span><span class="tok-p">(</span><span class="tok-n">videoFile</span><span class="tok-p">.</span><span class="tok-na">getAbsolutePath</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">streamPort</span><span class="tok-p">);</span>
<span class="tok-w">                        </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-k">default</span><span class="tok-p">:</span>
<span class="tok-w">                        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-s">&quot;ERROR: Unsupported protocol&quot;</span><span class="tok-p">;</span>
<span class="tok-w">                </span><span class="tok-p">}</span>

<span class="tok-w">                </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-s">&quot;STREAM:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">streamPort</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">videoFile</span><span class="tok-p">.</span><span class="tok-na">getName</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">protocol</span><span class="tok-p">;</span>
<span class="tok-w">            </span><span class="tok-p">}</span>

<span class="tok-w">        </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">error</span><span class="tok-p">(</span><span class="tok-s">&quot;Error starting video stream: {}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-na">getMessage</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-s">&quot;ERROR: Failed to start video stream&quot;</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Εδω βλεπουμε οτι η συναρτηση playVideo καλει την συναρτηση startTCPStream, startRTPStreamProcess και startUDPStream αναλογα με το πρωτοκολλο που εχει ζητηθει. Αυτες οι συναρτησεις ειναι υπευθυνες για την εκκινηση του stream με το αναλογο πρωτοκολλο. Η γενικη συναταξη των συναρτησεων ειναι παρομοια ομως για τι; απαιτησεις Buffering της εκφωνησης στο UDP εγινε χρηση των παρακατω options του mpgets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-w">        </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-f&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;mpegts&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;udp://127.0.0.1:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">port</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;?pkt_size=1316&amp;buffer_size=6553600&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Η παράμετρος "pkt_size=1316" ορίζει το μέγεθος κάθε πακέτου δεδομένων που αποστέλλεται κατά τη μετάδοση του video μέσω UDP. Αυτό το μέγεθος στοχεύει στο να κατανείμει το βίντεο σε μικρά κομμάτια ώστε να μειωθούν τα προβλήματα κατά την αποστολή και η παράμετρος "buffer_size=6553600" καθορίζει το μέγεθος του buffer που χρησιμοποιείται για τη λήψη δεδομένων. Με ένα μεγαλύτερο buffer, μειώνεται η πιθανότητα απώλειας πακέτων, διότι το σύστημα έχει περισσότερη "χώρο" για να συσσωρεύσει τα δεδομένα πριν τα επεξεργαστεί, κάτι που μπορεί να είναι ιδιαίτερα χρήσιμο σε συνθήκες μεταβλητής δικτυακής απόδοσης. Αυτες οι παραμετροι βοηθησαν στην σωστη μεταδοση του βίντεο με το πρωτοκολλο UDP.</p>
</div>
<div class="paragraph">
<p>Στην περίπτωση του πρωτοκόλλου RTP/UDP, η κλάση VideoManager καλεί την συναρτηση startRTPStreamProcess που δημιουργεί ένα SDP αρχείο για την περιγραφή της ροής.
Στην αρχή της μεθόδου, δημιουργείται ένα αντικείμενο File που αντιπροσωπεύει το SDP αρχείο. Το αρχείο αυτό τοποθετείται στον ίδιο φάκελο με το αρχείο βίντεο και η ονομασία του είναι "stream_" ακολουθούμενο από τον αριθμό της θύρας (streamPort), π.χ. "stream_5000.sdp". Επίσης, αν το αρχείο υπάρχει ήδη, διαγράφεται για να δημιουργηθεί νέο.
Στη συνέχεια, διαμορφώνεται η εντολή για την εκτέλεση του ffmpeg με τις απαραίτητες παραμέτρους. Το ffmpeg χρησιμοποιείται για να διαχειριστεί το stream και στις ρυθμίσεις της εντολής προσδιορίζεται η χρήση του RTP format με το flag "-f rtp". Η παράμετρος "-sdp_file" ακολουθούμενη από το απόλυτο path του SDP αρχείου λέει στο ffmpeg να δημιουργήσει το SDP αρχείο με τις απαραίτητες λεπτομέρειες για τη σύνδεση (π.χ. πληροφορίες για τις θύρες, codecs, κ.λπ).
Μόλις δημιουργηθεί το SDP αρχείο, διαβάζουμε το περιεχόμενό του (μέσω του java.nio.file.Files.readAllBytes) και το αποθηκεύουμε σε μια μεταβλητή (this.lastGeneratedSdpContent). Αυτή η μεταβλητή περιέχει πλέον το περιεχόμενο του SDP αρχείου, το οποίο στελνουμε μεσα απο το Java socket στον client ως εξης:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-w"> </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-s">&quot;STREAM:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">streamPort</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">videoFile</span><span class="tok-p">.</span><span class="tok-na">getName</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">protocol</span><span class="tok-w"> </span><span class="tok-o">+</span>
<span class="tok-s">&quot;:SDP:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">java</span><span class="tok-p">.</span><span class="tok-na">util</span><span class="tok-p">.</span><span class="tok-na">Base64</span><span class="tok-p">.</span><span class="tok-na">getEncoder</span><span class="tok-p">().</span><span class="tok-na">encodeToString</span><span class="tok-p">(</span><span class="tok-n">lastGeneratedSdpContent</span><span class="tok-p">.</span><span class="tok-na">getBytes</span><span class="tok-p">());</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dynamic_port_allocation"><a class="anchor" href="#_dynamic_port_allocation"></a><a class="link" href="#_dynamic_port_allocation">Dynamic Port Allocation</a></h5>
<div class="paragraph">
<p>Επισης παρατηρουμαι οτι υπαρχει η μεταβλητη stream port που ειναι υπευθυνη για την πορτα που θα χρησιμοποιηθει για την μεταδοση του βίντεο. Αυτη η μεταβλητη δεν εχει σταθερεσ τιμες για καθε προτοκολλο εφοσων αυτο θα μας περιοριζε σε λιγα παραλληλα streams ανα server (οσα και τα προτοκολλα μας αν υποθεσουμε μια πορτα ανα προτοκολλο). Ετσι η μεταβλητη αυτη ειναι δυναμικη οπως και η επιλογη πορτας και η επιλογη γινεται απο την παρακατω συναρτηση:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-nf">allocateFreePort</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-c1">// Create a server socket on port 0 - system will allocate a free port</span>
<span class="tok-w">            </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">ServerSocket</span><span class="tok-w"> </span><span class="tok-n">socket</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">ServerSocket</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">port</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-na">getLocalPort</span><span class="tok-p">();</span>
<span class="tok-w">                </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;Allocated port: {} for streaming&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">port</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">port</span><span class="tok-p">;</span>
<span class="tok-w">            </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">IOException</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-c1">// If allocation fails, use a random port in a reasonable range</span>
<span class="tok-w">            </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">port</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">40000</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">Random</span><span class="tok-p">().</span><span class="tok-na">nextInt</span><span class="tok-p">(</span><span class="tok-mi">10000</span><span class="tok-p">);</span><span class="tok-w"> </span><span class="tok-c1">// Between 40000-50000</span>
<span class="tok-w">            </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;Using random port: {} (socket allocation failed)&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">port</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">port</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Σε αντιθεση αν το πρωτοκολλο ειναι HLS, και υπαρχει το αναλογο hls directory και m3u8 αρχείο, τοτε θα εκτελεστει η συναρτηση startHLSHttpServer η οποια θα ξεκινησει εναν HTTP server για την εξυπηρετηση του HLS playlist. Αυτο υλοποιηθηκε εφοσων <strong>δεν υπαρχει τροπος να μεταδωθει το HLS playlist μεσω FFmpeg</strong> και ο μονος τροπος που βρεθηκε ωστε να μπορει να μεταδοθει το HLS playlist ειναι με την χρηση ενος HTTP server. Παρακατω παρατίθεται ενα αποσπασμα της συναρτησης αυτης:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">startHLSHttpServer</span><span class="tok-p">(</span><span class="tok-n">File</span><span class="tok-w"> </span><span class="tok-n">hlsDir</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">port</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-c1">// Create HTTP server on the specified port</span>
<span class="tok-w">            </span><span class="tok-n">com</span><span class="tok-p">.</span><span class="tok-na">sun</span><span class="tok-p">.</span><span class="tok-na">net</span><span class="tok-p">.</span><span class="tok-na">httpserver</span><span class="tok-p">.</span><span class="tok-na">HttpServer</span><span class="tok-w"> </span><span class="tok-n">server</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">com</span><span class="tok-p">.</span><span class="tok-na">sun</span><span class="tok-p">.</span><span class="tok-na">net</span><span class="tok-p">.</span><span class="tok-na">httpserver</span><span class="tok-p">.</span><span class="tok-na">HttpServer</span><span class="tok-p">.</span><span class="tok-na">create</span><span class="tok-p">(</span>
<span class="tok-w">                    </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">InetSocketAddress</span><span class="tok-p">(</span><span class="tok-n">port</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">);</span>

<span class="tok-w">            </span><span class="tok-n">server</span><span class="tok-p">.</span><span class="tok-na">createContext</span><span class="tok-p">(</span><span class="tok-s">&quot;/&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">com</span><span class="tok-p">.</span><span class="tok-na">sun</span><span class="tok-p">.</span><span class="tok-na">net</span><span class="tok-p">.</span><span class="tok-na">httpserver</span><span class="tok-p">.</span><span class="tok-na">HttpHandler</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-nd">@Override</span>
<span class="tok-w">                </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">handle</span><span class="tok-p">(</span><span class="tok-n">com</span><span class="tok-p">.</span><span class="tok-na">sun</span><span class="tok-p">.</span><span class="tok-na">net</span><span class="tok-p">.</span><span class="tok-na">httpserver</span><span class="tok-p">.</span><span class="tok-na">HttpExchange</span><span class="tok-w"> </span><span class="tok-n">exchange</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">IOException</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">requestPath</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">exchange</span><span class="tok-p">.</span><span class="tok-na">getRequestURI</span><span class="tok-p">().</span><span class="tok-na">getPath</span><span class="tok-p">();</span>

<span class="tok-w">                    </span><span class="tok-c1">// Default to master playlist</span>
<span class="tok-w">                    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">requestPath</span><span class="tok-p">.</span><span class="tok-na">equals</span><span class="tok-p">(</span><span class="tok-s">&quot;/&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-n">requestPath</span><span class="tok-p">.</span><span class="tok-na">isEmpty</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                        </span><span class="tok-n">requestPath</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;/master.m3u8&quot;</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Τελος η κλαση VideoManager εχει και την συναρτηση cleanupStreams που ειναι υπευθυνη για των τερματισμο όλων των ενεργών FFmpeg processes και την απελευθέρωση των πόρων.
Εφοσων ολες οι processes που δημιουργηθηκαν αποθυκευονται σε μια λιστα, η συναρτηση αυτη διαβαζει την λιστα και τερματιζει ολες τα processes που υπάρχουν στην λιστα. Παρακατω παρατίθεται ενα αποσπασμα της συναρτησης αυτης:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Process</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">activeProcesses</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">ConcurrentHashMap</span><span class="tok-o">&lt;&gt;</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-p">....</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">cleanupStreams</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Map</span><span class="tok-p">.</span><span class="tok-na">Entry</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Process</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">entry</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">activeProcesses</span><span class="tok-p">.</span><span class="tok-na">entrySet</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;Terminating stream process: {}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">entry</span><span class="tok-p">.</span><span class="tok-na">getKey</span><span class="tok-p">());</span>
<span class="tok-w">                </span><span class="tok-n">entry</span><span class="tok-p">.</span><span class="tok-na">getValue</span><span class="tok-p">().</span><span class="tok-na">destroy</span><span class="tok-p">();</span>
<span class="tok-w">            </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">logger</span><span class="tok-p">.</span><span class="tok-na">error</span><span class="tok-p">(</span><span class="tok-s">&quot;Error stopping stream {}: {}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">entry</span><span class="tok-p">.</span><span class="tok-na">getKey</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-na">getMessage</span><span class="tok-p">());</span>
<span class="tok-w">            </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-n">activeProcesses</span><span class="tok-p">.</span><span class="tok-na">clear</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_streaming_client"><a class="anchor" href="#_streaming_client"></a><a class="link" href="#_streaming_client">Streaming Client</a></h3>
<div class="paragraph">
<p>Υλοποιεί την κλάση που παρέχει το GUI του client, χειρίζεται την επικοινωνία με τον server, την παρουσίαση της λίστας βίντεο, την επιλογή πρωτοκόλλου/ποιότητας/φορμάτ και την εκκίνηση της αναπαραγωγής.</p>
</div>
<div class="sect3">
<h4 id="_μέθοδος_start"><a class="anchor" href="#_μέθοδος_start"></a><a class="link" href="#_μέθοδος_start">Μέθοδος start()</a></h4>
<div class="paragraph">
<p>Η μέθοδος entry‐point του JavaFX. Δημιουργεί όλα τα controls (ComboBox για video, quality, format, protocol), το TextArea για logs και τα κουμπιά “List”/“Play”. Καθορίζει handlers για selection changes και κλήσεις στην sendCommand() που στέλνει εντολές στον server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">start</span><span class="tok-p">(</span><span class="tok-n">Stage</span><span class="tok-w"> </span><span class="tok-n">primaryStage</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-p">....</span>
<span class="tok-c1">// Handle protocol selection change - disable quality/format for HLS</span>
<span class="tok-w">        </span><span class="tok-n">protocolSelector</span><span class="tok-p">.</span><span class="tok-na">setOnAction</span><span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">selectedProtocol</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">protocolSelector</span><span class="tok-p">.</span><span class="tok-na">getValue</span><span class="tok-p">();</span>
<span class="tok-w">            </span><span class="tok-kt">boolean</span><span class="tok-w"> </span><span class="tok-n">isHLS</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;HLS&quot;</span><span class="tok-p">.</span><span class="tok-na">equals</span><span class="tok-p">(</span><span class="tok-n">selectedProtocol</span><span class="tok-p">);</span>

<span class="tok-w">            </span><span class="tok-c1">// Disable quality and format selectors for HLS streaming</span>
<span class="tok-w">            </span><span class="tok-n">qualitySelector</span><span class="tok-p">.</span><span class="tok-na">setDisable</span><span class="tok-p">(</span><span class="tok-n">isHLS</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-n">formatSelector</span><span class="tok-p">.</span><span class="tok-na">setDisable</span><span class="tok-p">(</span><span class="tok-n">isHLS</span><span class="tok-p">);</span>

<span class="tok-w">            </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">isHLS</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">showMessage</span><span class="tok-p">(</span><span class="tok-s">&quot;HLS selected: Quality and format will be managed adaptively by the server&quot;</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-p">});</span>
<span class="tok-p">}</span>

<span class="tok-n">videoSelector</span><span class="tok-p">.</span><span class="tok-na">setOnAction</span><span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">selectedVideo</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">videoSelector</span><span class="tok-p">.</span><span class="tok-na">getValue</span><span class="tok-p">();</span>
<span class="tok-w">            </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">selectedVideo</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-n">videoMetadata</span><span class="tok-p">.</span><span class="tok-na">containsKey</span><span class="tok-p">(</span><span class="tok-n">selectedVideo</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">VideoMetadata</span><span class="tok-w"> </span><span class="tok-n">metadata</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">videoMetadata</span><span class="tok-p">.</span><span class="tok-na">get</span><span class="tok-p">(</span><span class="tok-n">selectedVideo</span><span class="tok-p">);</span>

<span class="tok-w">                </span><span class="tok-n">qualitySelector</span><span class="tok-p">.</span><span class="tok-na">getItems</span><span class="tok-p">().</span><span class="tok-na">clear</span><span class="tok-p">();</span>
<span class="tok-w">                </span><span class="tok-n">qualitySelector</span><span class="tok-p">.</span><span class="tok-na">getItems</span><span class="tok-p">().</span><span class="tok-na">addAll</span><span class="tok-p">(</span><span class="tok-n">metadata</span><span class="tok-p">.</span><span class="tok-na">getQualities</span><span class="tok-p">());</span>
<span class="tok-w">                </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">metadata</span><span class="tok-p">.</span><span class="tok-na">getQualities</span><span class="tok-p">().</span><span class="tok-na">isEmpty</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-n">qualitySelector</span><span class="tok-p">.</span><span class="tok-na">setValue</span><span class="tok-p">(</span><span class="tok-n">metadata</span><span class="tok-p">.</span><span class="tok-na">getQualities</span><span class="tok-p">().</span><span class="tok-na">get</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">));</span>
<span class="tok-w">                </span><span class="tok-p">}</span>

<span class="tok-w">                </span><span class="tok-n">formatSelector</span><span class="tok-p">.</span><span class="tok-na">getItems</span><span class="tok-p">().</span><span class="tok-na">clear</span><span class="tok-p">();</span>
<span class="tok-w">                </span><span class="tok-n">formatSelector</span><span class="tok-p">.</span><span class="tok-na">getItems</span><span class="tok-p">().</span><span class="tok-na">addAll</span><span class="tok-p">(</span><span class="tok-n">metadata</span><span class="tok-p">.</span><span class="tok-na">getFormats</span><span class="tok-p">());</span>
<span class="tok-w">                </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">metadata</span><span class="tok-p">.</span><span class="tok-na">getFormats</span><span class="tok-p">().</span><span class="tok-na">isEmpty</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-n">formatSelector</span><span class="tok-p">.</span><span class="tok-na">setValue</span><span class="tok-p">(</span><span class="tok-n">metadata</span><span class="tok-p">.</span><span class="tok-na">getFormats</span><span class="tok-p">().</span><span class="tok-na">get</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">));</span>
<span class="tok-w">                </span><span class="tok-p">}</span>

<span class="tok-w">                </span><span class="tok-c1">// Make sure protocol selection is applied (in case HLS was selected)</span>
<span class="tok-w">                </span><span class="tok-n">protocolSelector</span><span class="tok-p">.</span><span class="tok-na">fireEvent</span><span class="tok-p">(</span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">javafx</span><span class="tok-p">.</span><span class="tok-na">event</span><span class="tok-p">.</span><span class="tok-na">ActionEvent</span><span class="tok-p">());</span>
<span class="tok-w">            </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Τα standard κομματια για την τοποθετηση των controls στο Scene και την εμφάνιση του παραθύρου εχουν παραληφθεί για ευαναγνωσία. Τα σημαντικοτερα σημεία είναι τα παραππανω.
Αρχικα εχουν δημιουργηθεί τα ComboBox για την επιλογή του βίντεο, της ποιότητας, του φορμάτ και του πρωτοκόλλου. Ομως σε περιπτωση που το πρωτοκόλλο είναι HLS, τα ComboBox για την ποιότητα και το φορμάτ απενεργοποιούνται, καθώς η διαχείριση αυτών γίνεται αυτόματα από τον server. Επισης στελνεται μήνυμα στο TextArea για να ενημερώσει τον χρήστη ότι η ποιότητα και το φορμάτ θα διαχειρίζονται αυτόματα από τον server.</p>
</div>
</div>
<div class="sect3">
<h4 id="_επικοινωνία_με_τον_server"><a class="anchor" href="#_επικοινωνία_με_τον_server"></a><a class="link" href="#_επικοινωνία_με_τον_server">Επικοινωνία με τον Server</a></h4>
<div class="paragraph">
<p>Η connectToServer προσπαθεί πρώτα να συνδεθεί στον nginx load-balancer (port 5060), κι αν αποτύχει κάνει fallback σε απευθείας Server (port 5058). Μετά την επιτυχή σύνδεση ξεκινάει thread που καλεί listenForMessages() και στέλνει αμέσως “LIST”.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">connectToServer</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// …existing code…</span>
<span class="tok-w">    </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">socket</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">Socket</span><span class="tok-p">(</span><span class="tok-n">host</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">primaryPort</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">input</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">DataInputStream</span><span class="tok-p">(</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-na">getInputStream</span><span class="tok-p">());</span>
<span class="tok-w">        </span><span class="tok-n">output</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">DataOutputStream</span><span class="tok-p">(</span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-na">getOutputStream</span><span class="tok-p">());</span>
<span class="tok-w">        </span><span class="tok-n">showMessage</span><span class="tok-p">(</span><span class="tok-s">&quot;Connected to &quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">host</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">primaryPort</span><span class="tok-p">);</span>

<span class="tok-w">        </span><span class="tok-c1">// Start server communication thread</span>
<span class="tok-w">         </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">Thread</span><span class="tok-p">(</span><span class="tok-k">this</span><span class="tok-p">::</span><span class="tok-n">listenForMessages</span><span class="tok-p">).</span><span class="tok-na">start</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-c1">// Get initial video list</span>
<span class="tok-w">        </span><span class="tok-n">sendCommand</span><span class="tok-p">(</span><span class="tok-s">&quot;LIST&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">IOException</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// fallback logic…</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>H listenForMessages τρέχει σε ξεχωριστό thread, διαβάζει συνεχώς UTF μηνύματα από τον server και τα προωθεί στο JavaFX thread μέσω Platform.runLater) → handleServerMessage(message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">listenForMessages</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">while</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">message</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-p">.</span><span class="tok-na">readUTF</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-n">Platform</span><span class="tok-p">.</span><span class="tok-na">runLater</span><span class="tok-p">(()</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-n">handleServerMessage</span><span class="tok-p">(</span><span class="tok-n">message</span><span class="tok-p">));</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Η sendCommand Στέλνει μία εντολή στον server με writeUTF(…), ενώ παράλληλα εμφανίζει στο TextArea το “Sent: …”.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">sendCommand</span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">command</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">command</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">trim</span><span class="tok-p">().</span><span class="tok-na">isEmpty</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-k">return</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-n">output</span><span class="tok-p">.</span><span class="tok-na">writeUTF</span><span class="tok-p">(</span><span class="tok-n">command</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-n">showMessage</span><span class="tok-p">(</span><span class="tok-s">&quot;Sent: &quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">command</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Η handleServerMessage() αν το μήνυμα ξεκινά με “Available videos:”, καλεί updateVideoList().
Αν ξεκινά με “STREAM:”, αναλύει port/filename/protocol (και σε περιπτωση RTP κανει decode το Base64 SDP file για RTP) και μετά καλεί playStream().
Διαφορετικά εμφανίζει απλά το μήνυμα.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">handleServerMessage</span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">message</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">message</span><span class="tok-p">.</span><span class="tok-na">startsWith</span><span class="tok-p">(</span><span class="tok-s">&quot;Available videos:&quot;</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">showMessage</span><span class="tok-p">(</span><span class="tok-n">message</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-n">updateVideoList</span><span class="tok-p">(</span><span class="tok-n">message</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">message</span><span class="tok-p">.</span><span class="tok-na">startsWith</span><span class="tok-p">(</span><span class="tok-s">&quot;STREAM:&quot;</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">String</span><span class="tok-o">[]</span><span class="tok-w"> </span><span class="tok-n">parts</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">message</span><span class="tok-p">.</span><span class="tok-na">split</span><span class="tok-p">(</span><span class="tok-s">&quot;:&quot;</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">parts</span><span class="tok-p">.</span><span class="tok-na">length</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-mi">3</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">port</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-p">.</span><span class="tok-na">parseInt</span><span class="tok-p">(</span><span class="tok-n">parts</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">filename</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">parts</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span><span class="tok-p">;</span>
<span class="tok-w">                </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">protocol</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">parts</span><span class="tok-p">.</span><span class="tok-na">length</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-mi">4</span><span class="tok-w"> </span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-n">parts</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">]</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;UDP&quot;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-c1">// Default to UDP</span>

<span class="tok-w">                </span><span class="tok-c1">// Extract SDP content if present (for RTP)</span>
<span class="tok-w">                </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">sdpContent</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">;</span>
<span class="tok-w">                </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">parts</span><span class="tok-p">.</span><span class="tok-na">length</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-mi">6</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-s">&quot;RTP/UDP&quot;</span><span class="tok-p">.</span><span class="tok-na">equals</span><span class="tok-p">(</span><span class="tok-n">protocol</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-s">&quot;SDP&quot;</span><span class="tok-p">.</span><span class="tok-na">equals</span><span class="tok-p">(</span><span class="tok-n">parts</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">]</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                        </span><span class="tok-c1">// Decode the Base64 SDP content</span>
<span class="tok-w">                        </span><span class="tok-n">sdpContent</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-p">(</span><span class="tok-n">java</span><span class="tok-p">.</span><span class="tok-na">util</span><span class="tok-p">.</span><span class="tok-na">Base64</span><span class="tok-p">.</span><span class="tok-na">getDecoder</span><span class="tok-p">().</span><span class="tok-na">decode</span><span class="tok-p">(</span><span class="tok-n">parts</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">]</span><span class="tok-p">));</span>
<span class="tok-w">                        </span><span class="tok-n">showMessage</span><span class="tok-p">(</span><span class="tok-s">&quot;Received SDP content for RTP streaming&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                    </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                        </span><span class="tok-n">showMessage</span><span class="tok-p">(</span><span class="tok-s">&quot;Error decoding SDP content: &quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-na">getMessage</span><span class="tok-p">());</span>
<span class="tok-w">                    </span><span class="tok-p">}</span>
<span class="tok-w">                </span><span class="tok-p">}</span>
<span class="tok-w">                </span><span class="tok-n">playStream</span><span class="tok-p">(</span><span class="tok-n">port</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">protocol</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">sdpContent</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">showMessage</span><span class="tok-p">(</span><span class="tok-n">message</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_updatevideoliststring"><a class="anchor" href="#_updatevideoliststring"></a><a class="link" href="#_updatevideoliststring">updateVideoList(String)</a></h4>
<div class="paragraph">
<p>Αναλύει το multiline μήνυμα “Available videos:” και γεμίζει ένα Map&lt;String,VideoMetadata&gt; με λίστες qualities/formats. <strong>Αυτη η συναρτηση γεμιζει τις λιστες των comboBox για τα βίντεο, ποιότητες και φορμάτ , δυναμικα βαση των δεδομένων που λαμβάνει από τον server</strong>. Π.χ. αν ο server δεν έχει βίντεο input-fish με ποιότητα 1080p, δεν θα εμφανιστεί η επιλογή αυτή στο qualitySelector comboBox οταν ο χρήστης επιλέξει το συγκεκριμένο βίντεο.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">updateVideoList</span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">listMessage</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">videoSelector</span><span class="tok-p">.</span><span class="tok-na">getItems</span><span class="tok-p">().</span><span class="tok-na">clear</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-n">videoMetadata</span><span class="tok-p">.</span><span class="tok-na">clear</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-n">String</span><span class="tok-o">[]</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">listMessage</span><span class="tok-p">.</span><span class="tok-na">split</span><span class="tok-p">(</span><span class="tok-s">&quot;\n&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-p">.</span><span class="tok-na">length</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span><span class="tok-p">.</span><span class="tok-na">trim</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-na">isEmpty</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-k">continue</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">dashIndex</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-na">indexOf</span><span class="tok-p">(</span><span class="tok-s">&quot; - &quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">videoName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-na">substring</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">dashIndex</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">qualities</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">parseListValues</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;Qualities: \\[([^\\]]*)\\]&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">formats</span><span class="tok-w">  </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">parseListValues</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;Formats: \\[([^\\]]*)\\]&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">videoMetadata</span><span class="tok-p">.</span><span class="tok-na">put</span><span class="tok-p">(</span><span class="tok-n">videoName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">VideoMetadata</span><span class="tok-p">(</span><span class="tok-n">qualities</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">formats</span><span class="tok-p">));</span>
<span class="tok-w">        </span><span class="tok-n">videoSelector</span><span class="tok-p">.</span><span class="tok-na">getItems</span><span class="tok-p">().</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-n">videoName</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-c1">// enable controls, fireEvent για populate selectors…</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_playstreamint_string_string"><a class="anchor" href="#_playstreamint_string_string"></a><a class="link" href="#_playstreamint_string_string">playStream(int, String, String)</a></h4>
<div class="paragraph">
<p>Σε νέο thread εκκινεί το ffplay ανάλογα με το πρωτόκολλο:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>UDP/TCP: “-i udp://127.0.0.1:port?…” / “tcp://127.0.0.1:port”</p>
</li>
<li>
<p>HLS: HTTP URL προς /master.m3u8</p>
</li>
<li>
<p>RTP/UDP: γράφει (base64‐decoded) SDP σε temp file, ρυθμίζει protocol_whitelist και -autoexit</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Παράλληλα γινεται χρηση flags για stats, probesize, autoexit και εμφανίζει την πλήρη εντολή.
Υπηρχε θεμα με την επιλογη autoexit, το οποίο δεν λειτουργούσε σωστά με το ffplay και έτσι προστέθηκε δικια μας μέθοδος monitorEmptyFramesAndOutput(Process, int) για να παρακολουθεί την έξοδο του ffplay και να κλείνει τον player αν εντοπιστούν N κενά frames (π.χ. “vq=    0KB”). Ετσι αν καποια φορα δεν λειτουργησει το autoexit, θα κλεισει ο player μετα απο N κενά frames. Εγιναν αρκετεσ δοκιμεσ με τουσ διακοπτες του ffplay και ενω σε καποια προτοκολλα (π.χ. UDP) βρηκαμε μια λυση οπως στο UDP να χρησιμοποιησουμε το timeout=1000000&amp;fifo_size=5000000 ωστε το window του player να κλεινει μετα τον τερματισμο του stream, σε αλλα προτοκολλα (π.χ. RTP) δεν λειτουργουσε σωστα και ετσι χρησιμοποιησαμε την δικια μας μεθοδο monitorEmptyFramesAndOutput(Process, int) για να παρακολουθει την εξοδο του ffplay και να κλεινει τον player αν εντοπιστουν N κενα frames.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">playStream</span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">port</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">protocol</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">sdpContent</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">Platform</span><span class="tok-p">.</span><span class="tok-na">runLater</span><span class="tok-p">(()</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-n">playButton</span><span class="tok-p">.</span><span class="tok-na">setDisable</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">));</span>

<span class="tok-w">        </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">Thread</span><span class="tok-p">(()</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">command</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">ArrayList</span><span class="tok-o">&lt;&gt;</span><span class="tok-p">();</span>
<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;ffplay&quot;</span><span class="tok-p">);</span>

<span class="tok-w">                </span><span class="tok-c1">// Simple protocol handling</span>
<span class="tok-w">                </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;RTP/UDP&quot;</span><span class="tok-p">.</span><span class="tok-na">equals</span><span class="tok-p">(</span><span class="tok-n">protocol</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-n">sdpContent</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-c1">// Create a temporary SDP file</span>
<span class="tok-w">                    </span><span class="tok-n">File</span><span class="tok-w"> </span><span class="tok-n">tempSdpFile</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">File</span><span class="tok-p">.</span><span class="tok-na">createTempFile</span><span class="tok-p">(</span><span class="tok-s">&quot;rtp_stream_&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;.sdp&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                    </span><span class="tok-n">tempSdpFile</span><span class="tok-p">.</span><span class="tok-na">deleteOnExit</span><span class="tok-p">();</span>

<span class="tok-w">                    </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">FileWriter</span><span class="tok-w"> </span><span class="tok-n">writer</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">FileWriter</span><span class="tok-p">(</span><span class="tok-n">tempSdpFile</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                        </span><span class="tok-n">writer</span><span class="tok-p">.</span><span class="tok-na">write</span><span class="tok-p">(</span><span class="tok-n">sdpContent</span><span class="tok-p">);</span>
<span class="tok-w">                    </span><span class="tok-p">}</span>

<span class="tok-w">                    </span><span class="tok-n">showMessage</span><span class="tok-p">(</span><span class="tok-s">&quot;Using SDP file: &quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">tempSdpFile</span><span class="tok-p">.</span><span class="tok-na">getAbsolutePath</span><span class="tok-p">());</span>
<span class="tok-w">                    </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-protocol_whitelist&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                    </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;file,rtp,udp&quot;</span><span class="tok-p">);</span>

<span class="tok-w">                    </span><span class="tok-c1">// Make sure stats output is visible</span>
<span class="tok-w">                    </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-stats&quot;</span><span class="tok-p">);</span>

<span class="tok-w">                    </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-i&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                    </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-n">tempSdpFile</span><span class="tok-p">.</span><span class="tok-na">getAbsolutePath</span><span class="tok-p">());</span>

<span class="tok-w">                    </span><span class="tok-c1">// Add -autoexit but we&#39;ll also use our custom monitor</span>
<span class="tok-w">                    </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-autoexit&quot;</span><span class="tok-p">);</span>

<span class="tok-w">                    </span><span class="tok-c1">// Show exact command being run</span>
<span class="tok-w">                    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">cmdStr</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-p">.</span><span class="tok-na">join</span><span class="tok-p">(</span><span class="tok-s">&quot; &quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">command</span><span class="tok-p">);</span>
<span class="tok-w">                    </span><span class="tok-n">showMessage</span><span class="tok-p">(</span><span class="tok-s">&quot;Running: &quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">cmdStr</span><span class="tok-p">);</span>

<span class="tok-w">                    </span><span class="tok-n">ProcessBuilder</span><span class="tok-w"> </span><span class="tok-n">pb</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">ProcessBuilder</span><span class="tok-p">(</span><span class="tok-n">command</span><span class="tok-p">);</span>
<span class="tok-w">                    </span><span class="tok-n">pb</span><span class="tok-p">.</span><span class="tok-na">redirectErrorStream</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>
<span class="tok-w">                    </span><span class="tok-n">Process</span><span class="tok-w"> </span><span class="tok-n">playerProcess</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">pb</span><span class="tok-p">.</span><span class="tok-na">start</span><span class="tok-p">();</span>
<span class="tok-w">                    </span><span class="tok-n">currentProcess</span><span class="tok-p">.</span><span class="tok-na">set</span><span class="tok-p">(</span><span class="tok-n">playerProcess</span><span class="tok-p">);</span>

<span class="tok-w">                    </span><span class="tok-c1">// Launch the empty frame monitor</span>
<span class="tok-w">                    </span><span class="tok-n">monitorEmptyFramesAndOutput</span><span class="tok-p">(</span><span class="tok-n">playerProcess</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">50</span><span class="tok-p">);</span><span class="tok-w"> </span><span class="tok-c1">// 50 empty frames threshold</span>
<span class="tok-w">                    </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-k">switch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">protocol</span><span class="tok-p">.</span><span class="tok-na">toUpperCase</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                        </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;UDP&quot;</span><span class="tok-p">:</span>
<span class="tok-w">                            </span><span class="tok-c1">// Use flags that ffplay actually supports</span>
<span class="tok-w">                            </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-fflags&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                            </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;discardcorrupt+flush_packets&quot;</span><span class="tok-p">);</span>

<span class="tok-w">                            </span><span class="tok-c1">// These proper options help detect when stream ends</span>
<span class="tok-w">                            </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-stats&quot;</span><span class="tok-p">);</span>

<span class="tok-w">                            </span><span class="tok-c1">// Keep good analysis parameters</span>
<span class="tok-w">                            </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-probesize&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                            </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;32768&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                            </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-analyzeduration&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                            </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;2000000&quot;</span><span class="tok-p">);</span>

<span class="tok-w">                            </span><span class="tok-c1">// Better UDP URL with timeout params that ffplay supports</span>
<span class="tok-w">                            </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-i&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                            </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;udp://127.0.0.1:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">port</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;?timeout=1000000&amp;fifo_size=5000000&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                            </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                        </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;TCP&quot;</span><span class="tok-p">:</span>
<span class="tok-w">                            </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-i&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                            </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;tcp://127.0.0.1:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">port</span><span class="tok-p">);</span>
<span class="tok-w">                            </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                        </span><span class="tok-k">case</span><span class="tok-w"> </span><span class="tok-s">&quot;HLS&quot;</span><span class="tok-p">:</span>
<span class="tok-w">                            </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-i&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                            </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;http://127.0.0.1:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">port</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;/master.m3u8&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                            </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">                        </span><span class="tok-k">default</span><span class="tok-p">:</span>
<span class="tok-w">                            </span><span class="tok-n">showMessage</span><span class="tok-p">(</span><span class="tok-s">&quot;Unsupported protocol: &quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">protocol</span><span class="tok-p">);</span>
<span class="tok-w">                            </span><span class="tok-k">return</span><span class="tok-p">;</span>
<span class="tok-w">                    </span><span class="tok-p">}</span>
<span class="tok-w">                </span><span class="tok-p">}</span>

<span class="tok-w">                </span><span class="tok-n">command</span><span class="tok-p">.</span><span class="tok-na">add</span><span class="tok-p">(</span><span class="tok-s">&quot;-autoexit&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_αυτοματο_κλείσιμο_του_ffplay"><a class="anchor" href="#_αυτοματο_κλείσιμο_του_ffplay"></a><a class="link" href="#_αυτοματο_κλείσιμο_του_ffplay">Αυτοματο κλείσιμο του ffplay</a></h4>
<div class="paragraph">
<p>Αυτη η συναρτηση διαβαζει το Output του process που θα της δωθει (ffplay) και εντοπίζει το string “vq=    0KB” , μετά από N κενά frames κλείνει τo process.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">monitorEmptyFramesAndOutput</span><span class="tok-p">(</span><span class="tok-n">Process</span><span class="tok-w"> </span><span class="tok-n">proc</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">threshold</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">Thread</span><span class="tok-p">(()</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">BufferedReader</span><span class="tok-w"> </span><span class="tok-n">reader</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">BufferedReader</span><span class="tok-p">(</span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">InputStreamReader</span><span class="tok-p">(</span><span class="tok-n">proc</span><span class="tok-p">.</span><span class="tok-na">getInputStream</span><span class="tok-p">()));</span>
<span class="tok-w">        </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">emptyCount</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-k">while</span><span class="tok-w"> </span><span class="tok-p">((</span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">reader</span><span class="tok-p">.</span><span class="tok-na">readLine</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">Platform</span><span class="tok-p">.</span><span class="tok-na">runLater</span><span class="tok-p">(()</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-n">messageArea</span><span class="tok-p">.</span><span class="tok-na">appendText</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;\n&quot;</span><span class="tok-p">));</span>
<span class="tok-w">            </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-na">contains</span><span class="tok-p">(</span><span class="tok-s">&quot;vq=    0KB&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-o">++</span><span class="tok-n">emptyCount</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-n">threshold</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">proc</span><span class="tok-p">.</span><span class="tok-na">destroy</span><span class="tok-p">();</span>
<span class="tok-w">                </span><span class="tok-k">break</span><span class="tok-p">;</span>
<span class="tok-w">            </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-na">contains</span><span class="tok-p">(</span><span class="tok-s">&quot;vq=    0KB&quot;</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">emptyCount</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-w">            </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}).</span><span class="tok-na">start</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_showmessagestring"><a class="anchor" href="#_showmessagestring"></a><a class="link" href="#_showmessagestring">showMessage(String)</a></h4>
<div class="paragraph">
<p>Εμφανίζει μηνύματα στο TextArea.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">showMessage</span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">message</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">Platform</span><span class="tok-p">.</span><span class="tok-na">runLater</span><span class="tok-p">(()</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">messageArea</span><span class="tok-p">.</span><span class="tok-na">appendText</span><span class="tok-p">(</span><span class="tok-n">message</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;\n&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">messageArea</span><span class="tok-p">.</span><span class="tok-na">setScrollTop</span><span class="tok-p">(</span><span class="tok-n">Double</span><span class="tok-p">.</span><span class="tok-na">MAX_VALUE</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">});</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_disconnect"><a class="anchor" href="#_disconnect"></a><a class="link" href="#_disconnect">disconnect()</a></h4>
<div class="paragraph">
<p>Καθαρή έξοδος: στέλνει “Bye” στον server, κλείνει streams/sockets και τερματίζει τυχόν τρέχουσα ffplay process.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">disconnect</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">currentProcess</span><span class="tok-p">.</span><span class="tok-na">get</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">currentProcess</span><span class="tok-p">.</span><span class="tok-na">get</span><span class="tok-p">().</span><span class="tok-na">destroyForcibly</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-n">output</span><span class="tok-p">.</span><span class="tok-na">writeUTF</span><span class="tok-p">(</span><span class="tok-s">&quot;Bye&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-n">input</span><span class="tok-p">.</span><span class="tok-na">close</span><span class="tok-p">();</span><span class="tok-w">  </span><span class="tok-n">output</span><span class="tok-p">.</span><span class="tok-na">close</span><span class="tok-p">();</span><span class="tok-w">  </span><span class="tok-n">socket</span><span class="tok-p">.</span><span class="tok-na">close</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_παρουσίαση_του_τελικού_υλοποιημένου_συστήματος"><a class="anchor" href="#_παρουσίαση_του_τελικού_υλοποιημένου_συστήματος"></a><a class="link" href="#_παρουσίαση_του_τελικού_υλοποιημένου_συστήματος"><strong>Παρουσίαση του τελικού υλοποιημένου συστήματος:</strong></a></h3>
<div class="paragraph">
<p>Το τελικό σύστημα αποτελείται από δύο κύρια μέρη: τον Server και τον Client. Ο Server εκτελειτε ειτε μεσω Docker για λειτουργεια τησ δυνατοτητας του load balancing,  ειτε ως executable απο το .jar αρχείο που δημιουργήθηκε. Ο Client είναι μια JavaFX εφαρμογή που επικοινωνεί με τον Server για την αναπαραγωγή βίντεο. Η οποια εκτελείται με το .jar αρχείο που δημιουργήθηκε.</p>
</div>
<div class="paragraph">
<p><strong>Επισης η εφαρμογη παρεχει logging με χρηση της βιβλιοθήκης SLF4J για την καταγραφή σημαντικών γεγονότων και σφαλμάτων. Στον Client, το logging εμφανίζεται στο TextArea της διεπαφής χρήστη, ενώ στον Server καταγράφεται σε αρχεία log. Αυτο θεωρηθηκε η πιο ορθη λυση για την παρακολούθηση της λειτουργίας του συστήματος και την αποσφαλμάτωση. Για τον ιδιο λογο, δεν υλοποιήθηκε γραφικό περιβάλλον για τον Server, καθως θα εκανε δυσκολότερη την υλοποίηση Load Balancing και δεν προσφέρει διδακτικά οφέλη.</strong></p>
</div>
<div class="sect3">
<h4 id="_dockerfile"><a class="anchor" href="#_dockerfile"></a><a class="link" href="#_dockerfile"><strong>Dockerfile</strong></a></h4>
<div class="paragraph">
<p>Παρακάτω παρατίθεται το Dockerfile που χρησιμοποιήθηκε για την δημιουργια του Server container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="dockerfile"><span></span><span class="tok-k">FROM</span><span class="tok-w"> </span><span class="tok-s">openjdk:11-jre-slim</span>

<span class="tok-k">RUN</span><span class="tok-w"> </span>apt-get<span class="tok-w"> </span>update<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span>apt-get<span class="tok-w"> </span>install<span class="tok-w"> </span>-y<span class="tok-w"> </span>ffmpeg<span class="tok-w"> </span><span class="tok-se">\</span>
<span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span>rm<span class="tok-w"> </span>-rf<span class="tok-w"> </span>/var/lib/apt/lists/*

<span class="tok-k">WORKDIR</span><span class="tok-w"> </span><span class="tok-s">/app</span>

<span class="tok-c"># copy in your already-built JAR ( before running docker run `mvn clean package`)</span>
<span class="tok-k">COPY</span><span class="tok-w"> </span>/target/multisrv-1.0-SNAPSHOT.jar<span class="tok-w"> </span>app.jar

<span class="tok-k">RUN</span><span class="tok-w"> </span>mkdir<span class="tok-w"> </span>-p<span class="tok-w"> </span>/videos
<span class="tok-k">VOLUME</span><span class="tok-w"> </span><span class="tok-s">/videos</span>

<span class="tok-k">ENTRYPOINT</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-s2">&quot;java&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;-jar&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s2">&quot;app.jar&quot;</span><span class="tok-p">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_docker_compose"><a class="anchor" href="#_docker_compose"></a><a class="link" href="#_docker_compose"><strong>docker compose</strong></a></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-nt">version</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;3.8&quot;</span>

<span class="tok-nt">services</span><span class="tok-p">:</span>
<span class="tok-w">  </span><span class="tok-nt">multimedia-server-1</span><span class="tok-p">:</span>
<span class="tok-w">    </span><span class="tok-nt">build</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">.</span>
<span class="tok-w">    </span><span class="tok-nt">network_mode</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">host</span>
<span class="tok-w">    </span><span class="tok-nt">environment</span><span class="tok-p">:</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">SERVER_ID=1</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">SERVER_PORT=5058</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">VIDEO_PATH=/videos</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">FFMPEG_PATH=/usr/bin</span>
<span class="tok-w">    </span><span class="tok-nt">volumes</span><span class="tok-p">:</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">/home/chris/OneDrive/Documents/8o examino/Multimedia/multisrv/videos:/videos</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">./logs:/app/logs</span>

<span class="tok-w">  </span><span class="tok-nt">multimedia-server-2</span><span class="tok-p">:</span>
<span class="tok-w">    </span><span class="tok-nt">build</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">.</span>
<span class="tok-w">    </span><span class="tok-nt">network_mode</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">host</span>
<span class="tok-w">    </span><span class="tok-nt">environment</span><span class="tok-p">:</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">SERVER_ID=2</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">SERVER_PORT=5059</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">VIDEO_PATH=/videos</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">FFMPEG_PATH=/usr/bin</span>
<span class="tok-w">    </span><span class="tok-nt">volumes</span><span class="tok-p">:</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">/home/chris/OneDrive/Documents/8o examino/Multimedia/multisrv/videos:/videos</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">./logs:/app/logs</span>


<span class="tok-w">  </span><span class="tok-nt">load-balancer</span><span class="tok-p">:</span>
<span class="tok-w">    </span><span class="tok-nt">image</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">nginx:alpine</span>
<span class="tok-w">    </span><span class="tok-nt">network_mode</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">host</span>
<span class="tok-w">    </span><span class="tok-nt">volumes</span><span class="tok-p">:</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">./nginx.conf:/etc/nginx/nginx.conf</span>
<span class="tok-w">    </span><span class="tok-nt">depends_on</span><span class="tok-p">:</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">multimedia-server-1</span>
<span class="tok-w">      </span><span class="tok-p tok-p-Indicator">-</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">multimedia-server-2</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nginx_config"><a class="anchor" href="#_nginx_config"></a><a class="link" href="#_nginx_config"><strong>nginx config</strong></a></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="nginx"><span></span><span class="tok-k">events</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kn">worker_connections</span><span class="tok-w"> </span><span class="tok-mi">1024</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-c1"># use stream{} to proxy raw TCP</span>
<span class="tok-k">stream</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kn">upstream</span><span class="tok-w"> </span><span class="tok-s">multimedia_servers</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-kn">server</span><span class="tok-w"> </span><span class="tok-n">127.0.0.1</span><span class="tok-p">:</span><span class="tok-mi">5058</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-kn">server</span><span class="tok-w"> </span><span class="tok-n">127.0.0.1</span><span class="tok-p">:</span><span class="tok-mi">5059</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-kn">server</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-kn">listen</span><span class="tok-w"> </span><span class="tok-mi">5060</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-kn">proxy_pass</span><span class="tok-w"> </span><span class="tok-s">multimedia_servers</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-c1"># optional timeouts, logging, etc.</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_εκτέλεση_του_συστήματος"><a class="anchor" href="#_εκτέλεση_του_συστήματος"></a><a class="link" href="#_εκτέλεση_του_συστήματος"><strong>Εκτέλεση του συστήματος:</strong></a></h4>
<div class="paragraph">
<p>Για να εκτελέσετε το σύστημα, ακολουθήστε τα παρακάτω βήματα:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Πρωτα εκτελέστε την εντολή <code>mvn clean package</code> για να δημιουργήσετε το .jar αρχείο του Server.</p>
</li>
<li>
<p>Στη συνέχεια, μπορείτε να εκτελέσετε το σύστημα με δύο τρόπους:</p>
</li>
<li>
<p>Με docker: απλα εκτελέστε την εντολή <code>docker-compose up --build</code> στον κατάλογο που περιέχει το docker-compose.yml αρχείο.</p>
</li>
<li>
<p>Local: εκτελέστε την εντολή <code>java -jar target/multisrv-1.0-SNAPSHOT.jar</code> στον κατάλογο που περιέχει το .jar αρχείο του Server.</p>
</li>
<li>
<p>Για τον Client, εκτελέστε την εντολή <code>mvn exec:java -Dexec.mainClass="com.multisrv.ClientGUI"</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_screenshots_εκτελέσεων"><a class="anchor" href="#_screenshots_εκτελέσεων"></a><a class="link" href="#_screenshots_εκτελέσεων"><strong>Screenshots εκτελέσεων:</strong></a></h4>
<div class="imageblock">
<div class="content">
<img src="Screenshot_20250613_224306.png" alt="Screenshot 20250613 224306">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Screenshot_20250613_223040.png" alt="Screenshot 20250613 223040">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Screenshot_20250613_223239.png" alt="Screenshot 20250613 223239">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="endvideoclient.png" alt="endvideoclient">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_load_balanced_screenshots"><a class="anchor" href="#_load_balanced_screenshots"></a><a class="link" href="#_load_balanced_screenshots"><strong>Load balanced Screenshots:</strong></a></h4>
<div class="imageblock">
<div class="content">
<img src="Screenshot_20250613_223131.png" alt="Screenshot 20250613 223131">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="LOADBALANCED.png" alt="LOADBALANCED">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Screenshot_20250613_223348.png" alt="Screenshot 20250613 223348">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Screenshot_20250613_223416.png" alt="Screenshot 20250613 223416">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_παρουσίαση_προβλημάτων_που_αντιμετωπίσαμε"><a class="anchor" href="#_παρουσίαση_προβλημάτων_που_αντιμετωπίσαμε"></a><a class="link" href="#_παρουσίαση_προβλημάτων_που_αντιμετωπίσαμε"><strong>Παρουσίαση προβλημάτων που αντιμετωπίσαμε</strong></a></h3>
<div class="sect3">
<h4 id="_σερβιρισμα_βίντεο_σε_πολλαπλους_χρήστες"><a class="anchor" href="#_σερβιρισμα_βίντεο_σε_πολλαπλους_χρήστες"></a><a class="link" href="#_σερβιρισμα_βίντεο_σε_πολλαπλους_χρήστες"><strong>Σερβιρισμα βίντεο σε πολλαπλους χρήστες:</strong></a></h4>
<div class="ulist">
<ul>
<li>
<p>Αρχικά, υπήρχε πρόβλημα με την ταυτόχρονη εξυπηρέτηση πολλαπλών χρηστών. Εφοσων γινοταν χρηση στατικων πορτών για τα streams, δεν μπορούσαμε να εξυπηρετήσουμε πολλαπλά αιτήματα του ιδιου προτοκόλλου ταυτόχρονα. Με την υλοποίηση δυναμικών θυρών για τα streams, το πρόβλημα αυτό επιλύθηκε, επιτρέποντας σε πολλούς χρήστες να συνδέονται και να αναπαράγουν βίντεο ταυτόχρονα.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_βελτίωση_της_λειτουργίας_απελευθέρωσης_κλειδώματος"><a class="anchor" href="#_βελτίωση_της_λειτουργίας_απελευθέρωσης_κλειδώματος"></a><a class="link" href="#_βελτίωση_της_λειτουργίας_απελευθέρωσης_κλειδώματος"><strong>Βελτίωση της λειτουργίας απελευθέρωσης κλειδώματος:</strong></a></h4>
<div class="ulist">
<ul>
<li>
<p>Πριν την υλοποίηση της βοηθητικής κλάσης (LockWithChannel), παρατηρήθηκε ότι κάποια αρχεία κλειδώματος δεν διαγράφονταν μετά την επιτυχή δημιουργία του βίντεο. Αν προέκυπτε οποιοδήποτε σφάλμα ή αν το αρχείο είχε καταλήξει σε ασυνεπή κατάσταση, παρέμενε στον κατάλογο, εμποδίζοντας νέες μετατροπές. Με τη δημιουργία της βοηθητικής κλάσης και τον έλεγχο μεταβλητών: Δημιουργήθηκε η κλάση <strong>LockWithChannel</strong> που αποθηκεύει το FileLock, το FileChannel και το RandomAccessFile που προκύπτουν κατά την απόκτηση του κλειδώματος. Όλες οι μεταβλητές ελέγχονται εντός try-catch block, ώστε σε περίπτωση εξαιρέσεων να εξασφαλίζεται ο σωστός τερματισμός (απελευθέρωση πόρων και κλείσιμο Streams).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_προβλήματα_με_την_αναπαραγωγή_βίντεο_μέσω_ffplay"><a class="anchor" href="#_προβλήματα_με_την_αναπαραγωγή_βίντεο_μέσω_ffplay"></a><a class="link" href="#_προβλήματα_με_την_αναπαραγωγή_βίντεο_μέσω_ffplay"><strong>Προβλήματα με την αναπαραγωγή βίντεο μέσω ffplay:</strong></a></h4>
<div class="ulist">
<ul>
<li>
<p>Αρχικά, υπήρχαν προβλήματα με την αναπαραγωγή βίντεο μέσω ffplay, ειδικά με το πρωτόκολλο RTP/UDP. Η δημιουργεια του SDP αρχείου και η σωστή αποστολη τους μεσα απο το Java socket ελυσαν το πρόβλημα.</p>
</li>
<li>
<p>Η προσθήκη της μεθόδου monitorEmptyFramesAndOutput(Process, int) βοήθησε στην παρακολούθηση της εξόδου του ffplay και στην αυτόματη διακοπή του player όταν δεν υπήρχαν δεδομένα για αναπαραγωγή.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_προβλήματα_με_την_υλοποιηση_adaptive_streaming"><a class="anchor" href="#_προβλήματα_με_την_υλοποιηση_adaptive_streaming"></a><a class="link" href="#_προβλήματα_με_την_υλοποιηση_adaptive_streaming"><strong>Προβλήματα με την υλοποιηση adaptive streaming:</strong></a></h4>
<div class="ulist">
<ul>
<li>
<p>Αρχικά, δεν γνωριζαμε ποιο προτοκολλο να χρησιμοποιήσουμε για την υλοποίηση του adaptive streaming. Μετά από έρευνα, επιλέχθηκε το HLS (HTTP Live Streaming) λογω τησ δυνατοτητας δημιουργίας των m3u8 playlists με FFmpeg ομως δεν γνωριζαμε οτι δεν υπηρχε τροπος να μεταδοθει το HLS playlist μεσω FFmpeg και ετσι χρειαστηκε η δημιουργια HTTP server για την εξυπηρετηση του HLS playlist. Ενδεχεται το προτοκολλο DASH να ήταν καλύτερη επιλογή, αλλά δεν υπήρχε αρκετός χρόνος για να το εξετάσουμε.</p>
</li>
<li>
<p>Δεν γνωριζαμε αν λειτουργει το adaptive streaming με το HLS και αν οντως αλλαζε .ts αρχεία αναλογα με την ποιοτητα δικτύου. Μετά από δοκιμές, σε Linux με το προγραμμα ngrok ωστε να κανουμε Public των http server μας και να μπορουμε να ελέγξουμε με online εργαλεία οπως το <a href="https://hlsjs.video-dev.org/demo/" class="bare">hlsjs.video-dev.org/demo/</a> αλλα και δοκιμη streaming σε κινητό με το VLC, διαπιστώσαμε ότι το adaptive streaming λειτουργεί σωστά.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_προβλήματα_με_την_υλοποιηση_load_balancing"><a class="anchor" href="#_προβλήματα_με_την_υλοποιηση_load_balancing"></a><a class="link" href="#_προβλήματα_με_την_υλοποιηση_load_balancing"><strong>Προβλήματα με την υλοποιηση Load balancing:</strong></a></h4>
<div class="ulist">
<ul>
<li>
<p>Αρχικά, υπήρξαν προβλήματα με την υλοποίηση του load balancing, καθώς δεν γνωρίζαμε πώς να διαχειριστούμε τις πολλαπλές συνδέσεις σε καθε server και την χρηση δυναμικων θυρών για τα streams. Μετά από έρευνα, αποφασίσαμε να χρησιμοποιήσουμε την επιλογη του Docker network:host, η οποια επιτρέπει στους containers να χρησιμοποιούν τις ίδιες θύρες με τον host, διευκολύνοντας την επικοινωνία μεταξύ τους.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-06-13 19:50:15 UTC
</div>
</div>
</body>
</html>